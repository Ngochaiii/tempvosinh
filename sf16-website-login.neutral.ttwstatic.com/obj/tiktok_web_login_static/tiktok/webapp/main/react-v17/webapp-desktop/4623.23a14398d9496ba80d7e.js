"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[4623],{30641:(e,t,n)=>{n.d(t,{I9:()=>c,Tq:()=>m,tR:()=>l});var o=n(78695),i=n(64388),s=n(1183);const c=(0,o._)((0,s.p)("commentItemAtom@tiktok/webapp-atoms",{}),{rehydrationKey:"webapp.comment.items"}),{useAtomService:r,useServiceState:m,useServiceDispatchers:a,getStaticApi:l}=(0,i.i)(c,(e,t)=>({setItem(e){t(c,t=>Object.assign(Object.assign({},t),{[e.cid]:e}))},setItemDiggState(n){e(c)[n.cid]&&t(c,e=>{var t,o;return Object.assign(Object.assign({},e),{[n.cid]:Object.assign(Object.assign({},e[n.cid]),{user_digged:n.digged,is_author_digged:null!==(t=n.is_author_digged)&&void 0!==t?t:null==(o=e[n.cid])?void 0:o.is_author_digged})})})},setItemDiggCount(n){e(c)[n.cid]&&t(c,e=>Object.assign(Object.assign({},e),{[n.cid]:Object.assign(Object.assign({},e[n.cid]),{digg_count:n.count})}))},removeItem(e){t(c,t=>{const n=t,o=e;return n[o],function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}(n,["symbol"==typeof o?o:o+""])})},multiSetCommentItem(e){t(c,t=>{const n=Object.assign({},t);return e.forEach(e=>{n[e.cid]=Object.assign(Object.assign({},n[e.cid]),e)}),n})},multiRemoveCommentItem(e){t(c,t=>{const n=Object.assign({},t);return e.forEach(e=>{delete n[e]}),n})},reduceOrIncreaseCommentCount({cid:n,isReduce:o}){var i,s;const r=e(c);if(!r[n])return;const m=Number(null!==(i=null==(s=r[n])?void 0:s.reply_comment_total)&&void 0!==i?i:0);t(c,e=>Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},e[n]),{reply_comment_total:o?m-1:m+1})}))}}))},39301:(e,t,n)=>{n.d(t,{PT:()=>m,bg:()=>d});var o=n(99789),i=n.n(o),s=n(23399),c=n(46833);const r={[s.m33.FollowRelationUnknown]:c.yf.UNKNOW,[s.m33.NoRelationStatus]:c.yf.NONE,[s.m33.FollowingStatus]:c.yf.FOLLOW,[s.m33.FollowEachOtherStatus]:c.yf.MUTAL,[s.m33.FollowRequestStatus]:c.yf.FOLLOWING_REQUEST};function m(e,t={}){var n;const o=i()(e,"user","reply_comment");return o.user=null!==(n=e.user.unique_id)&&void 0!==n?n:"",!e.reply_comment||t.ignoreReply?[o]:[o,...e.reply_comment.reduce((e,t)=>(m(t).forEach(t=>{e.push(t)}),e),[])]}function a(e){var t,n;return null!==(t=null==e||null==(n=e.url_list)?void 0:n.find(e=>!/\.webp/.test(e)))&&void 0!==t?t:""}function l({is_block:e,is_blocked:t,follow_status:n,follower_status:o}){if(null!=n)return e?c.yf.BLOCK:t?c.yf.BLOCKED:n===s.m33.NoRelationStatus&&o===s.FU4.FollowerFollowStatus?c.yf.FOLLOWER:r[n]}function d(e,t){const{avatar_larger:n,avatar_medium:o,avatar_thumb:i,uid:s,short_id:c,unique_id:r,sec_uid:m,room_id:d,nickname:u,is_block:_,is_blocked:g,follow_status:h,signature:p,show_favorite_list:v,custom_verify:f,enterprise_verify_reason:y,comment_setting:b,duet_setting:O,is_ad_fake:C,is_private_account:I,secret:w,show_secret_banner:j,stitch_setting:S,follower_status:R}=e;return{avatarLarger:a(n),avatarMedium:a(o),avatarThumb:a(i),id:s,shortId:c,uniqueId:null!=r?r:"",secUid:null!=m?m:"",roomId:d?String(d):void 0,nickname:u,relation:l({is_block:_,is_blocked:g,follow_status:h,follower_status:R}),signature:p,openFavorite:v,verified:Boolean(f||y),commentSetting:b,duetSetting:O,stitchSetting:S,isADVirtual:C,privateAccount:Boolean(I)||Boolean(w),secret:Boolean(w),createTime:0,showPrivateBanner:Boolean(j),extraInfo:Object.assign({followerStatus:R},t)}}},54623:(e,t,n)=>{n.d(t,{lN:()=>T,OL:()=>E,BY:()=>M,kH:()=>P,_B:()=>x});var o=n(84573),i=n.n(o),s=n(300),c=n.n(s),r=n(18499),m=n(69742),a=n(96406),l=n(48156),d=n(43703),u=n(87215),_=n(23037),g=n(78695),h=n(64388),p=n(1183),v=n(86599),f=n(16356),y=n(38335),b=n(37783),O=n(30641),C=n(39301),I=(n(54133),n(40746)),w=n(35762),j=n(17384),S=function(e,t,n,o){return new(n||(n=Promise))(function(i,s){function c(e){try{m(o.next(e))}catch(e){s(e)}}function r(e){try{m(o.throw(e))}catch(e){s(e)}}function m(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,r)}m((o=o.apply(e,t||[])).next())})};const R=(0,I.M)({csr:function(e){return S(this,void 0,void 0,function*(){return w.h.get("/api/comment/list/",{query:Object.assign(Object.assign({},e),{count:20,aid:1988,app_language:"ja-JP",device_platform:"web_pc",current_region:"JP",fromWeb:1,enter_from:"tiktok_web"}),baseUrlType:j.Z4.FixedWww})})}});var F=n(89768),k=n(59966),L=function(e,t,n,o){return new(n||(n=Promise))(function(i,s){function c(e){try{m(o.next(e))}catch(e){s(e)}}function r(e){try{m(o.throw(e))}catch(e){s(e)}}function m(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,r)}m((o=o.apply(e,t||[])).next())})};const T={awemeId:void 0,cursor:"0",comments:[],hasMore:!0,loading:!1,isFirstLoad:!1,fetchType:"load_by_current"},U=(0,g._)((0,p.p)("commentAtom@tiktok/webapp-atoms",{}),{rehydrationKey:"webapp.comment"}),{useAtomService:P,useServiceState:x,useServiceDispatchers:M,getStaticApi:E}=(0,h.i)(U,(e,t)=>({setCommentItem({itemId:e="",item:n}){n&&t(U,t=>{var o;return Object.assign(Object.assign({},t),{[e]:Object.assign(Object.assign({},null!==(o=t[e])&&void 0!==o?o:T),n)})})},setReplyLoading(n){var o,i,s,c;const[r,m]=D(e,n);r&&(r.replyCache=Object.assign(Object.assign({},null!==(o=r.replyCache)&&void 0!==o?o:{comments:null!==(i=r.reply_comment)&&void 0!==i?i:[],cursor:null!==(s=null==(c=r.reply_comment)?void 0:c.length)&&void 0!==s?s:"0",hasMore:!0}),{loading:n.loading}),B(t,n.itemId,m,Object.assign({},r)))},setReplyComment(n){const[o,i]=D(e,n);o&&B(t,n.itemId,i,Object.assign(Object.assign({},o),{reply_comment:n.comments}))},setReplyCommentCache(n){var o,i;const[s,c]=D(e,n);s&&(s.replyCache={comments:n.comments,cursor:n.cursor,hasMore:n.hasMore,loading:null!==(o=null==(i=s.replyCache)?void 0:i.loading)&&void 0!==o&&o},B(t,n.itemId,c,Object.assign({},s)))},deleteCommentFromList(n){const{index:o,subIndex:i,itemId:s}=n;if(void 0===i)B(t,s,o);else{var c,r;const n=e(U)[s];if(!n)return;const m=Object.assign({},n.comments[o]);null==(c=m.reply_comment)||c.splice(i,1),null==(r=m.replyCache)||r.comments.splice(i,1),B(t,s,o,m)}},addCommentToFirst(e){t(U,t=>{var n,o;return Object.assign(Object.assign({},t),{[e.aweme_id]:Object.assign(Object.assign(Object.assign({},T),t[e.aweme_id]),{comments:[{cid:e.cid,reply_comment:[],replyCache:null},...null!==(n=null==(o=t[e.aweme_id])?void 0:o.comments)&&void 0!==n?n:[]]})})})},addReplyToFirst({comment:n,position:o}){var i,s,c,r;const m=e(U),{aweme_id:a}=n,l=m[a];if(!l)return;const d=l.comments[o];if(!d)return;const u=Object.assign({},d);u.reply_comment=[{cid:n.cid,reply_comment:null,replyCache:null},...null!==(i=d.reply_comment)&&void 0!==i?i:[]],u.replyCache=Object.assign(Object.assign({},null!==(s=u.replyCache)&&void 0!==s?s:{cursor:"0",hasMore:!0,loading:!1}),{comments:[{cid:n.cid,reply_comment:null,replyCache:null},...null!==(c=null==(r=u.replyCache)?void 0:r.comments)&&void 0!==c?c:[]]}),B(t,a,o,u)},handlePostSuccess(e){const{users:t,commentItems:n}=A([e]);(0,r.unstable_batchedUpdates)(()=>{this.addCommentToFirst(e),(0,f.Gp)().multiSetUser(t),(0,O.tR)().multiSetCommentItem(n),(0,b.ud)().reduceOrIncreaseCommentCount({id:e.aweme_id,isReduce:!1})})},handleReplySuccess(e){const{comment:t,position:n}=e,{users:o,commentItems:i}=A([t],{ignoreReply:!0}),s=(0,O.tR)();(0,r.unstable_batchedUpdates)(()=>{this.addReplyToFirst({comment:t,position:n}),(0,f.Gp)().multiSetUser(o),s.multiSetCommentItem(i),s.reduceOrIncreaseCommentCount({cid:t.reply_id}),(0,b.ud)().reduceOrIncreaseCommentCount({id:t.aweme_id,isReduce:!1})})},fetchComment(t,n){var o;return L(this,void 0,void 0,function*(){const i=e(U),{aweme_id:s,insert_ids:m,fetch_type:a="load_by_current"}=t,l=null!==(o=i[t.aweme_id])&&void 0!==o?o:{awemeId:void 0,cursor:"0",comments:[],hasMore:!0,loading:!0},_=(0,v.PJ)(e(v.WH));if(!l.hasMore)return;const g=l.cursor;this.setCommentItem({item:{awemeId:s,loading:!0},itemId:s});try{var h,p;const e=yield R({insert_ids:"0"===g?m:void 0,aweme_id:s,cursor:g,is_non_personalized:_});if((0,d.G)(e.status_code,[u.s.Ok]),e.status_code===u.s.Ok&&(null==(h=e.comments)?void 0:h.length)){var y;const{users:t,comments:o,commentItems:i}=A(e.comments,{logId:null==(y=e.log_pb)?void 0:y.impr_id});if(n){const{translateTo:e,count:t}=n,o=i.filter(t=>"un"!==t.comment_language&&t.comment_language!==e).slice(0,t);yield(0,k.mx)().fetchCommentTranslation(o,e,!0)}const m=l.comments,d=c()(m.concat(o),"cid");(0,r.unstable_batchedUpdates)(()=>{(0,f.Gp)().multiSetUser(t),(0,O.tR)().multiSetCommentItem(i),this.setCommentItem({item:{comments:d,hasMore:Boolean(e.has_more),cursor:e.cursor,loading:!1,isFirstLoad:0===Number(g),fetchType:a},itemId:s}),e.total&&(0,b.ud)().setCommentCount({id:s,commentCount:Number(e.total)})})}else e.status_code!==u.s.Ok||(null==(p=e.comments)?void 0:p.length)||e.has_more||this.setCommentItem({item:{hasMore:Boolean(e.has_more),loading:!1},itemId:s})}catch(e){this.setCommentItem({item:{loading:!1},itemId:s})}})},fetchCommentReply(t){var n,o;return L(this,void 0,void 0,function*(){const[i,s]=N(e,t);if(s){this.setReplyLoading(Object.assign(Object.assign({},i),{loading:!0}));try{var m;const e=yield function(e){return S(this,void 0,void 0,function*(){return w.h.get("/api/comment/list/reply/",{query:Object.assign(Object.assign({},e),{count:3,aid:1988,app_language:"ja-JP",device_platform:"web_pc",current_region:"JP",fromWeb:1,enter_from:"tiktok_web"}),baseUrlType:j.Z4.FixedWww})})}({comment_id:i.cid,item_id:i.itemId,cursor:null!==(n=null==(m=s.replyCache)?void 0:m.cursor)&&void 0!==n?n:"0"});if((0,d.G)(e.status_code,[u.s.Ok]),e.status_code===u.s.Ok){var a;const{users:t,comments:n,commentItems:m}=A(e.comments,{logId:null==(a=e.log_pb)?void 0:a.impr_id}),l=null!==(o=s.reply_comment)&&void 0!==o?o:[],d=c()(l.concat(n),"cid");(0,r.unstable_batchedUpdates)(()=>{(0,f.Gp)().multiSetUser(t),(0,O.tR)().multiSetCommentItem(m),this.setReplyComment(Object.assign({comments:[...d]},i)),this.setReplyCommentCache(Object.assign({comments:[...d],hasMore:Boolean(e.has_more),cursor:e.cursor},i)),this.setReplyLoading(Object.assign(Object.assign({},i),{loading:!1}))})}}catch(e){this.setReplyLoading(Object.assign(Object.assign({},i),{loading:!1}))}}else console.warn("No item here in fetch commoent reply")})},handleCollapseReply(t){const[n]=D(e,t);n?this.setReplyComment(Object.assign(Object.assign({},t),{comments:[]})):console.warn("item is null")},handleShowMoreReply(t){return L(this,void 0,void 0,function*(){const[{cid:n,itemId:o},i]=N(e,t);if(a.f.sendEvent("show_more_reply",{parent_comment_id:n,group_id:o}),!i)return void console.warn("item is null");if(!i.reply_comment||!i.replyCache)return this.fetchCommentReply(t);const s=i.reply_comment.length,c=i.replyCache.comments.length;if(s<c){const e=s+3>c?c:s+3;return this.setReplyComment(Object.assign(Object.assign({},t),{comments:i.replyCache.comments.slice(0,e)}))}return this.fetchCommentReply(t)})},handleCommentLike(t){var n,o;return L(this,void 0,void 0,function*(){var i;const s=e(O.I9),c=e(f.p9),d=s[t.cid],{user:g}=(0,F.x)(),h=null==g?void 0:g.uid,p=null==(i=e(b.Pu)[t.itemId])?void 0:i.authorId,v=c.users[null!==(n=null==d?void 0:d.user)&&void 0!==n?n:""];if(!d)return void console.warn("No comment item here in hendle comment like");const C=d.user_digged?2:1;try{const e=yield function(e){return S(this,void 0,void 0,function*(){return w.h.post("/api/comment/digg/",{query:Object.assign(Object.assign({},e),{aid:1988,channel_id:u.F.Hot}),headers:{[j.nk]:w.h.csrfToken},baseUrlType:j.Z4.FixedWww})})}({aweme_id:t.itemId,cid:t.cid,digg_type:C}),n=(0,y.T)();if((null==e?void 0:e.status_code)===u.s.Ok?a.f.sendEvent(1===C?"like_comment":"cancel_like_comment",{comment_id:t.cid,group_id:t.itemId,comment_user_id:null!==(o=null==v?void 0:v.id)&&void 0!==o?o:"",author_id:t.teaAuthorId}):(null==e?void 0:e.status_code)===u.s.CommentLikePermissionDisable?(l.F.destroy(),l.F.open({content:n(2===C?"comment_turnoff_unlike":"comment_turnoff_like"),duration:3,getContainer:_.M,getContainerPosition:"fixed"})):(null==e?void 0:e.status_code)?(l.F.destroy(),l.F.open({content:n("Sorry, something wrong with the server, please try again."),duration:3,widthType:"half",getContainer:_.M,getContainerPosition:"fixed"})):(l.F.destroy(),l.F.open({content:n("comment_nointernet_toast"),duration:3,widthType:"half",getContainer:_.M,getContainerPosition:"fixed"})),e.status_code===u.s.Ok){let e,n,o;1===C?(e=1,n=d.digg_count+1,h===p&&(o=!0)):(e=0,n=Math.max(d.digg_count-1,0),h===p&&(o=!1));const i=(0,O.tR)();(0,r.unstable_batchedUpdates)(()=>{i.setItemDiggState({cid:t.cid,digged:e,is_author_digged:o}),i.setItemDiggCount({cid:t.cid,count:n})})}else e.status_code===u.s.CommentLikePermissionDisable&&(0,b.ud)().updateItem({id:t.itemId,itemCommentStatus:m.v.OFF})}catch(e){}})},handleCommentDelete(e){return L(this,void 0,void 0,function*(){const t=(0,y.T)(),{itemId:n,cid:o,parentCid:i,subIndex:s}=e;try{const c=yield function(e){return S(this,void 0,void 0,function*(){return w.h.post("/api/comment/delete/",{query:e,baseUrlType:j.Z4.FixedWww,headers:{[j.nk]:w.h.csrfToken}})})}({cid:o});if(c.status_code===u.s.Ok?l.F.open({content:t("comment_delete_success"),duration:3,widthType:"half",getContainer:_.M,getContainerPosition:"fixed"}):l.F.open({content:t("comment_delete_failed"),duration:3,widthType:"half",getContainer:_.M,getContainerPosition:"fixed"}),c.status_code===u.s.Ok){const t=(0,O.tR)();(0,r.unstable_batchedUpdates)(()=>{this.deleteCommentFromList(e),t.removeItem(o),(0,b.ud)().reduceOrIncreaseCommentCount({id:n,isReduce:!0}),void 0!==s&&i&&t.reduceOrIncreaseCommentCount({cid:i,isReduce:!0})})}}catch(e){}})},switchVideo(e){return L(this,void 0,void 0,function*(){const{currId:t,insertCid:n}=e;yield this.fetchComment({insert_ids:n,aweme_id:t})})},handleCommentsPreload(e){const{aweme_id:t,fetch_type:n,has_more:o,cursor:i,total:s}=e,{users:c,comments:m,commentItems:a}=A(e.comments);(0,r.unstable_batchedUpdates)(()=>{(0,f.Gp)().multiSetUser(c),(0,O.tR)().multiSetCommentItem(a),this.setCommentItem({item:{comments:m,hasMore:Boolean(o),cursor:i,loading:!1,isFirstLoad:!0,fetchType:n},itemId:t}),s&&(0,b.ud)().setCommentCount({id:t,commentCount:Number(s)})})}}));function N(e,t){const[n,o]=D(e,t);return[t,n,o]}function D(e,{itemId:t,cid:n}){const o=e(U)[t];if(!o)return[void 0,-1];const i=o.comments,s=i.findIndex(({cid:e})=>e===n);return-1!==s?[i[s],s]:[void 0,-1]}function B(e,t,n,o){-1!==n&&e(U,e=>{var s,c;const r=null!==(s=null==(c=e[t])?void 0:c.comments)&&void 0!==s?s:[];let m=[];return m=o?[...r.slice(0,n),i()(Object.assign(Object.assign({},r[n]),o)),...r.slice(n+1)]:[...r.slice(0,n),...r.slice(n+1)],Object.assign(Object.assign({},e),{[t]:Object.assign(Object.assign(Object.assign({},T),e[t]),{comments:m})})})}function A(e=[],t={}){return e.reduce((e,n)=>{const{user:o,reply_comment:i}=n;return e.users.push((0,C.bg)(o)),(null!=i?i:[]).forEach(({user:t})=>{e.users.push((0,C.bg)(t))}),e.comments.push(W(n,t)),(0,C.PT)(n,t).forEach(t=>{e.commentItems.push(t)}),e},{users:[],comments:[],commentItems:[]})}function W(e,t={}){var n;return{cid:e.cid,logId:t.logId,reply_comment:null==(n=e.reply_comment)?void 0:n.map(e=>W(e,t)),replyCache:null}}},69742:(e,t,n)=>{n.d(t,{v:()=>o});var o=function(e){return e[e.PUBLIC=0]="PUBLIC",e[e.FRIENDS_ONLY=1]="FRIENDS_ONLY",e[e.OFF=3]="OFF",e}({})}}]);