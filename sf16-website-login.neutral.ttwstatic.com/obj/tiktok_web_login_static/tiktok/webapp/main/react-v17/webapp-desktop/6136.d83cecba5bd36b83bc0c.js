"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[6136],{5060:(e,t,r)=>{r.d(t,{a:()=>i,k:()=>a});var n=r(96406);const a=e=>{n.f.event("video_data_size",e)},i=e=>{n.f.event("basic_player_cdn_cost",e)}},11271:(e,t,r)=>{r.d(t,{re:()=>O,Cd:()=>w});var n,a,i,o=r(96406),l=r(39001),s=r(87507),d=r(9429);!function(e){e[e.HaveNothing=0]="HaveNothing",e[e.HaveMetaData=1]="HaveMetaData",e[e.HaveCurrentData=2]="HaveCurrentData",e[e.HaveFutureData=3]="HaveFutureData",e[e.HaveEnoughData=4]="HaveEnoughData"}(n||(n={})),function(e){e[e.PlayStop=0]="PlayStop",e[e.ResumePlaying=1]="ResumePlaying"}(a||(a={})),function(e){e.PlayQuality="video_play_quality",e.PlayEnded="video_play_end",e.PlayFailed="video_play_failed",e.BlockStart="video_block_start",e.Block="video_block",e.Request="video_request",e.RequestResponse="video_request_response",e.FirstFrame="first_feed_show_time"}(i||(i={}));const u={0:"one_column",1:"three_column",2:"browser_mode",3:"video_detail",5:"pip",4:"fullscreen",6:"creator_tab",7:"mini_player",8:"immersive_player",9:"tiktok_stories"},c=e=>e&&Array.isArray(e)?e.map(e=>`${e.QualityType}:${e.Bitrate}`):null,p=()=>({cpu_core:"undefined"==typeof navigator?0:navigator.hardwareConcurrency,memory_size:"undefined"==typeof navigator?0:navigator.deviceMemory,HEVC_supported:(0,d.ng)()?1:0}),v=e=>void 0!==e&&e.length>0?1e3*Math.round(e.end(0)-e.start(0)):0,h=(e,t)=>e?2:t?1:0,y=(e="")=>{if(!e)return"";const t=e.match(/https?:\/\/([^/]+)\//i);let r="";return(null==t?void 0:t[1])&&(r=t[1]),r},f=e=>{var t;const{id:r,authorId:n,playMode:a,forFriend:i=!1,secret:o=!1,play_url:l,awemeType:s,picCnt:d,playlist_id:c="",popup_type:p="",size:v=-1}=e;return{group_id:r,author_id:n,play_mode:null!==(t=u[a])&&void 0!==t?t:"others",logo_type:"",item_status:h(i,o),play_url:l,host:y(l),aweme_type:null!=s?s:0,pic_cnt:d,playlist_id:c,popup_type:p,size:v}},_=(e,t)=>{const r=(e=>!e||/^(\d)*p$/i.test(`${e}`))(t);return r?e&&t?`${e}_${t}`:`unknownQuality_fromServer_${e}_${t}`:t},m=e=>{const{bitrate:t=-1,format:r="",codecType:n="",encodedType:a="",videoQuality:i="",definition:o="",encodeUserTag:l="",originalDefinition:s=""}=e;return{video_bitrate:t,video_format:r,codec_format:n,encoded_type:a,bitrate_quality:i,video_quality:String(_(i,o)),video_encodeUserTag:l,original_definition:s}},g=e=>{const{preload_size:t=-1,preload_time:r=-1,video_type:n="mp4",player_type:a="defaultPlayer"}=e;return{preload_size:t,preload_time:r,player_type:a,video_type:n}},b=e=>{const{totalWatchCount:t,foruWatchCount:r}=e;return{watch_count_total:t,watch_count_foru:r}},P={isPause:null,isVideoLoaded:!1,isFirstPlayReported:!1,isFirstPlayEndReported:!1,isInPlaybackStage:!1,triggerPlayTimestamp:0,firstTriggerPlayTimestamp:0,loadStartTimestamp:0,blockStartTimestamp:0,blockStartProgress:0,playingStartTimestamp:0,pauseStartTimestamp:0,totalPauseDuration:0,volume:0,muted:!0,mutedStateChange:!1,videoSourceLoadTime:0,cacheDuration:0,cacheSize:0,dataPlayerType:0,playSize:0,cdnSizeVideo:0,frameInfo:{drop_frame:0,total_play_frame:-1,drop_frame_rate:-1,drop_frame_duration:0}},S={currentSrc:"",duration:0,error:null,currentTime:0,readyState:0,buffered:{start:()=>0,end:()=>0,length:0},volume:0,muted:!0,mutedStateChange:!1};let T=1,k="",C="";const w=e=>{k=e};class O{constructor(){this.innerStates=Object.assign({},P),this.innerVideoAttributeStates=Object.assign({},S),this.isFirstFrameReported=!1,this.resetState=()=>{this.innerStates=Object.assign({},P),k="",this.isFirstFrameReported=!1,this.innerVideoAttributeStates=Object.assign({},S)},this.resetStateWhenSlideChange=()=>{this.innerStates=Object.assign({},P),this.innerVideoAttributeStates=Object.assign({},S)},this.reset=(e,t)=>{k!==e&&(this.playEndEvent(t),this.blockEndEvent(Object.assign(Object.assign({},t),{endType:0})),this.innerStates=Object.assign({},P))},this.resetWhenSlideChange=e=>{this.playEndEvent(Object.assign(Object.assign({},e),this.innerVideoAttributeStates)),this.blockEndEvent(Object.assign(Object.assign(Object.assign({},e),{endType:0}),this.innerVideoAttributeStates)),this.innerVideoAttributeStates=Object.assign({},S)},this.updateFrameInfo=e=>{this.innerStates.frameInfo=e},this.handlePlay=()=>{this.innerStates.triggerPlayTimestamp=Date.now();const{firstTriggerPlayTimestamp:e}=this.innerStates;e||(this.innerStates.firstTriggerPlayTimestamp=Date.now())},this.handlePause=e=>{const{id:t}=e,{playingStartTimestamp:r,isPause:n}=this.innerStates;t&&r&&!n&&(this.innerStates.pauseStartTimestamp=Date.now()),this.innerStates.isPause=!0},this.handleTimeUpdate=e=>{const{triggerPlayTimestamp:t,isFirstPlayReported:r,pauseStartTimestamp:n,videoSourceLoadTime:a,loadStartTimestamp:i}=this.innerStates,{currentTime:l=0,duration:d=0,codecType:u,volume:v=0,muted:h=!0,bitrateInfo:y,buffered:_,currentSrc:P,error:S,readyState:T}=e;if(this.innerVideoAttributeStates.duration=d,this.innerVideoAttributeStates.currentTime=l,this.innerVideoAttributeStates.buffered=_,this.innerVideoAttributeStates.currentSrc=P,this.innerVideoAttributeStates.error=S,this.innerVideoAttributeStates.readyState=T,!(l<=0)){if(!r&&0!==t){const r=Date.now()-t-1e3*l,n=Date.now()-i,_=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},f(e)),m(e)),g(e)),b(e)),p()),{duration:r>0?Math.round(r):0,video_duration:Math.round(1e3*d),is_bytevc1:(null!=u?u:"").indexOf("h265")>-1?1:0,muted:h?1:0,bitrate_set:(0,s.OK)(y),quality_bitrate:c(y),duration_from_load:Math.round(n),duration_with_load:Math.round(r+a),is_same:k===C?1:0});o.f.event("video_play_quality",_),C=k,this.innerStates.isFirstPlayReported=!0,this.innerStates.playingStartTimestamp=Date.now(),this.innerStates.volume=v,this.innerStates.muted=h}if(this.innerStates.mutedStateChange=this.innerStates.mutedStateChange||this.innerStates.muted!==h,this.innerStates.muted=h,!this.isFirstFrameReported&&performance&&this.firstFrameEvent(),this.innerStates.isPause){const e=n?Date.now()-n:0;this.innerStates.totalPauseDuration+=e}this.blockEndEvent(Object.assign(Object.assign({},e),{endType:1})),this.innerStates.isInPlaybackStage=!0,this.innerStates.isPause=!1}},this.handleEnded=()=>{this.innerStates.isInPlaybackStage=!1},this.handleError=e=>{const{isVideoLoaded:t,isInPlaybackStage:r}=this.innerStates,{error:n,codecType:a="",duration:i,play_url:l}=e,{code:s=0,message:u=""}=null!=n?n:{},c=l?(0,d.bp)(l):-1,v=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},f(e)),m(e)),b(e)),p()),{error_code:String(s),error_info:u,is_bytevc1:a.indexOf("h265")>-1?1:0,duration:null!=i?i:0,isExpired:c,isSupportMP4:(0,d.vk)(),is_before:t&&r?0:1});o.f.event("video_play_failed",v)},this.handleWaiting=e=>{const{currentTime:t=0,duration:r=0}=e,{isInPlaybackStage:n,blockStartTimestamp:a,isPause:i}=this.innerStates;if(0!==t&&t!==r&&n&&!1===i&&0===a){const r=Object.assign(Object.assign(Object.assign({},f(e)),b(e)),p());o.f.event("video_block_start",r),this.innerStates.blockStartTimestamp=Date.now(),this.innerStates.blockStartProgress=1e3*t}},this.handleLoadStart=e=>{const t=Object.assign(Object.assign(Object.assign(Object.assign({},f(e)),b(e)),p()),(0,l.Mp)(e));o.f.event("video_request",t),this.innerStates.loadStartTimestamp=Date.now()},this.handleLoadedData=e=>{this.responseEvent(e),this.innerStates.isVideoLoaded=!0},this.firstFrameEvent=()=>{const e=performance.timeOrigin,t={feed_total:e?Math.round(Date.now()-e):-1};o.f.event("first_feed_show_time",t),this.isFirstFrameReported=!0}}updateNativePlayerCDNCache(e,t){this.innerStates.cacheDuration=e,this.innerStates.cacheSize=t}msePlayerCacheUpdate(e){void 0!==e&&(this.innerStates.cdnSizeVideo+=e)}updatePlayerType(e){this.innerStates.dataPlayerType=e}blockEndEvent(e){const{currentTime:t=0,codecType:r,endType:n,should_filter:a=!1,droppedRate:i}=e,{blockStartTimestamp:l,blockStartProgress:s,isInPlaybackStage:d,isVideoLoaded:u}=this.innerStates;if(u&&d&&0!==l&&(1e3*t!==s||0===n)){const d=Date.now()-l-(1e3*t-s),u=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},f(e)),m(e)),g(e)),p()),{duration:d>=0?Math.round(d):0,is_bytevc1:(null!=r?r:"").indexOf("h265")>-1?1:0,end_type:n,position:Math.round(1e3*t),should_filter:a?"1":"0",droppedRate:i});o.f.event("video_block",u),this.innerStates.blockStartTimestamp=0}}responseEvent(e){const{loadStartTimestamp:t}=this.innerStates,{error:r,videoQuality:n,definition:a,play_url:i,codecType:s}=e,u=i?(0,d.bp)(i):-1,c=Date.now()-t;this.innerStates.videoSourceLoadTime=c;const v=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},f(e)),p()),b(e)),{error_code:String(null==r?void 0:r.code),duration:c,is_success:r?"0":"1",video_quality:n&&a?`${n}_${a}`:""}),(0,l.Mp)(e)),{isExpired:u,isSupportMP4:(0,d.vk)(),is_bytevc1:(null!=s?s:"").indexOf("h265")>-1?1:0});o.f.event("video_request_response",v)}playEndEvent(e){const{isFirstPlayReported:t,isFirstPlayEndReported:r,playingStartTimestamp:n,totalPauseDuration:a,firstTriggerPlayTimestamp:i,volume:l,frameInfo:s}=this.innerStates,{bitrate:d}=e;if(!r&&n){const{buffered:r,duration:u=0,currentTime:c=0,readyState:h,volume:y=0,muted:_,codecType:b}=e,P=n?Date.now()-n-a:0,S=d?d/8*((P>1e3*u?1e3*u:P)/1e3):-1,k=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},f(e)),m(e)),g(e)),p()),{is_success:t?"1":"0",video_duration:isNaN(u)?0:Math.round(1e3*u),play_duration:Math.round(1e3*c),buffering:(null!=h?h:0)<=2?1:0,duration:P>=0?Math.round(P):0,wait_duration:n>0?0:Date.now()-i,cur_cache_duration:v(r),local_time_ms:Date.now(),volume_level:Number(y.toFixed(4)),volume_change:t?Number((y-l).toFixed(4)):0,muted:_?1:0,click_mute:this.innerStates.mutedStateChange?_?2:1:0,session_order:T++,play_size:Math.round(S),data_player_type:this.innerStates.dataPlayerType,cache_size:1===this.innerStates.dataPlayerType?-10:Math.round(this.innerStates.cacheSize),cache_duration:1===this.innerStates.dataPlayerType?-10:Math.round(this.innerStates.cacheDuration),cdn_size_video:this.innerStates.cdnSizeVideo}),s),{is_bytevc1:(null!=b?b:"").indexOf("h265")>-1?1:0});o.f.event("video_play_end",k),this.innerStates.isFirstPlayEndReported=!0}}}},21172:(e,t,r)=>{r.d(t,{A:()=>n});var n=new(r(85135).A)},47910:(e,t,r)=>{r.d(t,{VL:()=>l,qW:()=>o});var n=r(64388);const a=(0,r(1183).p)("videoActualResolutionState@tiktok/webapp-atoms",{actualResolution:""}),{useAtomService:i,useServiceState:o,useServiceDispatchers:l,getStaticApi:s}=(0,n.i)(a,(e,t)=>({setVideoActualResolution(e){t(a,t=>Object.assign(Object.assign({},t),{actualResolution:e}))}}))},53397:(e,t,r)=>{r.d(t,{JX:()=>o,ZQ:()=>c,as:()=>l});var n=r(72516),a=r(7672);let i=3,o=class{constructor(){this.preloadQueue=[],this.preloadStartIndex=-1,this.currentPage="",this.preloadUrlsPool=new Set,this.setPreloadQueue=e=>{e.length&&(this.preloadQueue=null!=e?e:[],e.forEach(({id:e})=>{e&&this.preloadUrlsPool.add(e)}))},this.setPreloadIndex=e=>{e>=0&&(this.preloadStartIndex=e)},this.getPreloadUrls=()=>{const{preloadStartIndex:e}=this;return this.preloadQueue.slice(e+1,e+i+1)},this.getPreloadedPool=()=>this.preloadUrlsPool,this.reset=()=>{this.preloadQueue=[],this.preloadStartIndex=-1,this.preloadUrlsPool.clear()},this.setCurrentPage=e=>{this.currentPage=e||"unknown"},this.clearAllVideoCaches=()=>{this.currentPage&&this.preloadUrlsPool.clear()}}};o=(0,n.__decorate)([(0,a._)()],o);const l=e=>{i=e},s={byteLength:-1,duration:-1,type:-1,vid:"unknown"};class d{constructor(){this.preloadVideoId="",this.preloadVideoCache=s,this.setPreloadCacheInfo=(e,t)=>{e&&t&&e!==this.preloadVideoId&&(this.preloadVideoId=e,this.preloadVideoCache=t)},this.getPreloadCacheInfo=e=>e&&this.preloadVideoId&&e===this.preloadVideoId?this.preloadVideoCache:s}}let u=null;const c=()=>(u||(u=new d),u)},56764:(e,t,r)=>{r.d(t,{K:()=>a});var n=r(11271);class a{constructor(e="webapp",{playReport:t,experienceReport:r}){this.project=e,this._platform="",this._url="",this._playMode=0,this._videoQualityHandleParams=null,this._videoPlayHandleParams=null,this._playbackAttributes=null,this.isIos=!1,this.isAndroid=!1,this.videoExperienceReport=r,this.videoPlayReport=t,this.videoQualityReport=new n.re,this.renderState="",this.playerType=""}set platform(e){this._platform=e,this.isIos="ios"===this._platform,this.isAndroid="android"===this._platform}set playMode(e){this._playMode=e}set url(e){this._url=e}set videoQualityHandleParams(e){this._videoQualityHandleParams=e}set videoPlayHandleParams(e){this._videoPlayHandleParams=e}set playbackAttributes(e){this._playbackAttributes=e}updateMetricsParams({playbackAttribute:e,videoQualityParams:t}){e&&(this.playbackAttributes=e),t&&(this.videoQualityHandleParams=t)}onPlay(){}onPlaying(){this.videoExperienceReport.reportVideoInteract({endTime:Date.now(),videoSource:this._url})}onPause(){this._videoPlayHandleParams&&this._playbackAttributes&&this.videoPlayReport.handlePause(Object.assign(Object.assign({},this._videoPlayHandleParams),this._playbackAttributes))}onWaiting(){this._videoPlayHandleParams&&this._playbackAttributes&&this.videoPlayReport.handleWaiting(Object.assign(Object.assign({},this._videoPlayHandleParams),this._playbackAttributes))}onLoadStart(){}onLoadedData(){}onCanPlay(){this.videoExperienceReport.getCurrentPageReport()||(this.videoExperienceReport.reportVideoFirstScreen({endTime:Date.now(),videoSource:this._url}),this.videoExperienceReport.reportVideoAddition({endTime:Date.now(),videoSource:this._url}))}onCanPlayThrough(){this.isIos&&(this.videoExperienceReport.getCurrentPageReport()||(this.videoExperienceReport.reportVideoFirstScreen({endTime:Date.now(),videoSource:this._url}),this.videoExperienceReport.reportVideoAddition({endTime:Date.now(),videoSource:this._url})))}onTimeUpdate(){var e;this._videoQualityHandleParams&&this._videoPlayHandleParams&&this._playbackAttributes&&("webapp-mobile"===this.project?this.videoPlayReport.handleTimeUpdate(Object.assign(Object.assign(Object.assign({},this._videoPlayHandleParams),this._playbackAttributes),{render_state:this.renderState}),!0):this.videoPlayReport.handleTimeUpdate(Object.assign(Object.assign(Object.assign({},this._videoPlayHandleParams),this._playbackAttributes),{render_state:this.renderState,player_type:this.playerType}))),!this.videoExperienceReport.getFirstFrameReport()&&this._playbackAttributes&&this.videoExperienceReport.reportVideoFirstFrame(null!==(e=this._playbackAttributes.currentTime)&&void 0!==e?e:-1)}onError(){this._videoPlayHandleParams&&this.videoPlayReport.handleError(this._videoPlayHandleParams)}onEnded(){this._videoPlayHandleParams&&this.videoPlayReport.handleEnded(this._videoPlayHandleParams)}onSlideChange(e){var t,r;0!==(null!==(r=null===(t=this._playbackAttributes)||void 0===t?void 0:t.duration)&&void 0!==r?r:0)&&this._videoPlayHandleParams&&this.videoPlayReport.handlePlayTime(this._videoPlayHandleParams)}onUnmount(e){this.isIos||this.onSlideChange(e)}onProgress(e,t){}mseCDNCache(e){}pauseAction(e){this.videoPlayReport.triggerPause({enter_method:e,playMode:this.playMode})}setPlayerType(e){this.playerType=e}setRenderState(e){this.renderState=e}updateFrameInfo(e){}}},76890:(e,t,r)=>{r.d(t,{I:()=>de});var n,a,i=r(72516),o=r(2787),l=r(42780),s=r(67018),d=r(66003),u=r(21172),c=r(96406),p=r(19664),v=r(71225),h=r(7508),y=r(1880),f=r(40099);!function(e){e.NoInteract="failed because the user didn't interact with the document first.",e.Interrupted="request was interrupted by a call to pause",e.SafariNoInteract="The request is not allowed by the user agent or the platform in the current context",e.FireFox="The play method is not allowed by the user agent or the platform in the current context, possibly because the user denied permission.",e.LoadInterrupt="request was interrupted by a new load request",e.Abort="The operation was aborted",e.AbortRequest="new load request"}(n||(n={})),function(e){e.LOAD="load",e.WAITING="waiting",e.PAUSE="pause",e.ENDED="ended",e.ERROR="error",e.PLAYING="playing"}(a||(a={}));const _="use-credentials",m="PRELOAD_INFO",g="autoplay_was_prevented";let b=[];function P(e){e/=1e3,b.length>10&&b.pop(),b.unshift(e);let t=.5*b[0],r=.5*b[0];b.length>1&&(r=b.reduce((e,t,r)=>0===r?e:e+t,0)/(b.length-1)*.5);let n=t+r;return n>40&&(n=40),n}let S=-1;function T(){return S}var k=r(11271),C=r(5060),w=r(9429),O=r(55340),R=r(23039),M=r(87412),E=r(53397),I=r(4629),A=r(6978),j=r(4972);const D="IHEVCSoftWareDecoder",x=new class{constructor(){this.enableState=!1,this.checkResult=null,this.h265SoftInfo=null,this.config={workerUrl:"https://www.tiktok.com/webapp-desktop/static/worker/ttvideo-worker-CTvWXoSE.js",maxDecodeSize:1e3,powerfulDecodeFps:10,powerfulFFCost:1e3,continuousLowDecodeTime:1e3},this.state=-1,this.stats={s_open:0,s_support:0,s_enable:0}}setPlayerH265SoftInfo(e){const t=(0,A.i)();if(this.stats.s_support=t,!e||t<1)return!1;this.h265SoftInfo=e;const r=s.M.checkSoftHevcResult(e);this.checkResult=r;const{enableSoftwareH265:n=0,config:a={}}=e;return n>0&&(this.updateConfig(a),this.prefetchSoftwareWorkerJS()),r.open?(this.enableState=!0,!0):(this.enableState=!1,!1)}enable(e){this.setPlayerH265SoftInfo(e),this.enableState=!0}disable(){this.enableState=!1}getStats(){const{open:e=!1,hardware:t=!1,deviceScore:r=!1,playMode:n=!1}=this.checkResult||{};return Object.assign({worker_state:this.state,s_testopen:e?1:0,s_hardware:t?1:0,s_score:r?1:0,s_playmode:n?1:0},this.stats)}use(){return this.canUse()&&1===this.state}canUse(){const e=!(0,I.Zo)(),t=s.M.checkSoftHevcResult(this.h265SoftInfo);this.stats.s_enable=this.enableState?1:0,this.stats.s_open=t.open?1:0;const r=(0,A.i)();return this.stats.s_support=r,e&&this.enableState&&t.open&&r>0}prefetchSoftwareWorkerJS(e){const{state:t}=this;if(t>=0)return;this.state=0,(0,w.Tb)(D,j.Ay.version,"prefetchSoftwareWorkerJS ready");const r=e||this.config.workerUrl,n=(0,A.p)(r);n&&n.then?n.then(e=>{(0,w.Tb)(D,"prefetchSoftwareWorkerJS success",e),e?(j.Ay.updateTTVideoConfig({workerUrl:r}),j.Ay.preloadWorker(),this.state=1):this.state=2}).catch(e=>{this.state=2}):this.state=3}updateConfig(e){const t=Object.assign(Object.assign({},this.config),e);j.Ay.updateTTVideoConfig(t),this.config=t}},H=(e,t)=>{const r=[];return e.forEach((e,n)=>{const a=((e,t,r)=>{if(!Array.isArray(e)||e.length<1)return;const n=[];return e.forEach(e=>{const t=(a=e.url)?Array.isArray(a)?a.map(e=>({src:e})):"string"==typeof a?a:[]:[],r=e.codecType||"h264";var a;!t||Array.isArray(t)&&0===t.length||n.push({url:t,definition:e.definition,bitrate:e.bitrate,duration:e.duration,qualityType:e.qualityType,vtype:"MP4",codecType:r.includes("h265")?"h265":"h264"})}),{order:t,data:{vid:`${e[0].id}`,payload:n,preloadTime:r,codecType:e[0].codecType}}})(e,n,t);a&&a.data.payload.length>0&&r.push(a)}),r};function L(e,t,r){try{if(!e)return"";const{host:n}=new URL(e);return t.filter(e=>e===n).length>0?"anonymous":r.filter(e=>e===n).length>0?"use-credentials":""}catch(e){return""}}const F=e=>!!e,V={player_type:"playerType",video_play_mode:"videoPlayMode",preloader:"preloader",muted:"muted"};let q=null,B=null,Q=null,N=[],U={group1:["v16-webapp.tiktok.com","v16m-webapp.tiktokcdn-us.com"],group2:["v16-webapp-prime.tiktok.com","v16-webapp-prime.us.tiktok.com","v19-webapp-prime.us.tiktok.com"]};function $(e){return e?l.P.NEW_TT:l.P.XG}function z(e,t,r){if(t.length>0){N=[],t.forEach(e=>{N.push(e)});const r=$(e);d.IH.clearTask(r);const n=H(t,10);d.IH.addPreloadList(n,r)}}function W(e,t){d.IH.changeCodec(t,$(e))}function G(e,t){const r=(null==e?void 0:e.length)||0,n=(null==e?void 0:e.filter(e=>"h264"===e.CodecType))||[],a=[];return!e||r<1||0===n.length?a.push(function(e){const t=e.defaultDefinition||"default";let r=[];return r=e.url instanceof Array?e.url:e.url?[{src:e.url}]:[],{codecType:"h264",url:r,vtype:"MP4",qualityType:e.qualityType||0,definition:t,bitrate:e.defaultBitrate||0,gearName:t}}(t)):e.forEach(e=>{var t,r,n,i,o,l;const s=(null===(t=e.PlayAddr)||void 0===t?void 0:t.UrlList)||[];var d;a.push({bitrate:e.Bitrate,size:(null===(r=e.PlayAddr)||void 0===r?void 0:r.DataSize)||0,width:(null===(n=e.PlayAddr)||void 0===n?void 0:n.Width)||0,height:(null===(i=e.PlayAddr)||void 0===i?void 0:i.Height)||0,fileId:(null===(o=e.PlayAddr)||void 0===o?void 0:o.FileHash)||"",uri:(null===(l=e.PlayAddr)||void 0===l?void 0:l.Uri)||"",codecType:(d=e.CodecType,d.includes("h265")?"h265":"h264"),gearName:e.GearName,definition:e.GearName,qualityType:e.QualityType,mvmaf:e.MVMAF||"",url:s.map(e=>({src:e})),vtype:"MP4"})}),a}const K=e=>L(e.url,U.group1,U.group2)===_?{credentials:"include"}:{};function X(e){return e===l.R.ACTIVE}function Y(e){return e?e instanceof Array?e.length>0?e[0].src:"":e:""}function J(e,t){return null==e||e.playerOpenMse,l.h.MSE}function Z(e){return("v1"===e||"v2"===e)&&!!s.a.canUseHevc("v2"===e?1:2)}var ee=r(87507);const te={color:"#fff",backgroundColor:"#2a9d1f",position:"absolute",zIndex:2,top:"30px"},re=(0,f.memo)((0,f.forwardRef)(function({containerId:e="",classList:t=[],player:r,bitrateInfo:n,oncanplay:a,onplay:i,onwaiting:d,onended:u,ontimeupdate:p,onloadstart:v,onloadeddata:_,onvolumechange:m,onVideoPlayEnd:g,onResolutionReady:b,onFirstFrame:P,onerror:S,onpause:T,onplaying:k,onbreak:C,subtitle:O,teaParams:R,videoDimensionParams:M,mode:I,id:A,containerRef:j,hitPreload:D},x){const H=(0,f.useMemo)(()=>{let e={};if(!R)return e;const t=null==r?void 0:r.attributes;let n=0;R.forFriend&&(n=2),R.secret&&(n=1);let a="";if(t&&t.src){const e=/^(?:https?:\/\/)?([^\/\s:]+)/,r=t.src.match(e);a=r?r[1]:""}const i={group_id:A,author_id:R.author_id||"",play_mode:(0,ee.AI)(I),logo_type:"unwatermarked",item_status:n,play_url:t?t.src:"",host:a,aweme_type:R.aweme_type||0,pic_cnt:R.pic_cnt||0,playlist_id:R.playlist_id||"",popup_type:R.popup_type||"",size:R.size,log_id:R.log_id||"none",is_ad:R.isAd,video_width:M?M.video_width:0,video_height:M?M.video_height:0,video_duration:M?M.video_duration:0,player_type:(null==r?void 0:r.playerType)||""},{dScore:o,netScore:l}=s.M.getDeviceScore(),d=function(){const e=B||Q;return null==e?void 0:e.device}();return e=Object.assign({},{cpu_core:(null==d?void 0:d.cpu)||0,memory_size:(null==d?void 0:d.memory)||0,HEVC_supported:(null==d?void 0:d.isHEVCSupported)?1:0,hardware_score:o,network_score:l},i),e},[R,M,A,I]),L=(0,f.useRef)(0),F=(0,f.useCallback)(()=>{if(!r||!R)return null;const e=r.curDefinition||{};return(0,ee.H4)(e.definition,R.definition)},[r,R]),V=(0,f.useCallback)(()=>r&&R&&(r.curDefinition||{}).bitrate||0,[r,R]),q=(0,f.useCallback)(()=>r&&R?(r.curDefinition||{}).codecType:null,[r,R]),N=(0,f.useCallback)(()=>{let e="";if(!R)return e;const t=F();return R.videoQuality&&t&&(e=`${R.videoQuality}_${t}`),e},[R,F]),U=(0,f.useCallback)(()=>{const e={};if(R){const t=V(),n=q(),a=N(),i=(0,E.ZQ)(),o=(null==r?void 0:r.state)||"default";let l;A&&(l=i.getPreloadCacheInfo(A)),e.video_bitrate=t||R.bitrate,e.video_format=R.format,e.codec_format=n||"h264",e.encoded_type=R.encodedType,e.bitrate_quality=R.videoQuality,e.video_quality=a,e.video_encodeUserTag=R.encodeUserTag,e.original_definition=R.definition,e.preload_size=l?l.byteLength:-1,e.preload_time=l?Math.floor(l.duration):-1,e.player_type=r?r.type:"defaultPlayer",e.video_type="mp4",e.render_state=o}return e},[R,F,V,q,N,A,r]),$=(0,f.useCallback)(()=>{let e=!1,t=q();return t||(t="h264"),e=!!t&&t.indexOf("h265")>-1,e},[q]),z=(0,f.useCallback)(()=>{(0,h.uQ)(y.Y.VideoRequest),H&&1!==I&&c.f.event("video_request",Object.assign(Object.assign({},H),{render_state:(null==r?void 0:r.state)||""}))},[H,I]),W=(0,f.useCallback)(e=>{if(!H||1===I)return;let t;(null==r?void 0:r.attributes)&&(t=r.attributes.error);const n=N(),a=$(),i=Object.assign({},{duration:Math.round(e.duration),error_code:t?String(t.code):"",is_success:t?"0":"1",video_quality:n,is_bytevc1:a?1:0,isExpired:2,isSupportMP4:Number((0,w.vk)()),render_state:(null==r?void 0:r.state)||""},H);c.f.event("video_request_response",i)},[H,$,N,I]),G=(0,f.useCallback)(()=>{if(!H||1===I||(null==r?void 0:r.state)!==l.R.ACTIVE)return;const{attributes:e}=r;if(e){const{readyState:t,seeking:r}=e;L.current=t<1?1:r?2:0}c.f.event("video_block_start",Object.assign(Object.assign({},H),{block_type:L.current}))},[H,I,null==r?void 0:r.uuid]),K=(0,f.useCallback)(e=>{if(!H||1===I||!r)return;const t=U(),n=$();let a,i=0;r.attributes&&(a=r.attributes.error,i=r.attributes.duration);let o=e.code||0,l=e.message||"";o<=0&&a&&(o=a.code,l=a.message);const s=Object.assign({},t,{error_code:String(o),error_info:l,is_bytevc1:n?1:0,duration:Math.round(1e3*i),isExpired:e.isExpired||0,isSupportMP4:Number((0,w.vk)()),is_before:0===e.status?0:1,retry_c:e.retryCount||0,retry_l:e.retryList||[]},H);c.f.event("video_play_failed",s)},[H,U,$,I]),X=(0,f.useCallback)(e=>{if(null==C||C(),!H||1===I)return;const t=U(),n=$();let a,i,o=0;const l=e.currentTime;let s=0,d=1,u=!1;const p=e.duration-e.pauseDuration;(null==r?void 0:r.attributes)&&(a=r.attributes.error,o=r.attributes.duration||0,s=r.attributes.readyState,i=r.attributes.buffered,d=r.attributes.volume,u=r.attributes.muted);const v=Math.min(p,1e3*o);let h=V();h<=0&&(h=R&&R.bitrate?R.bitrate:0);const y=h/8*(v/1e3),f=Object.assign({},t,{is_success:a?"0":"1",video_duration:Math.round(1e3*o),play_duration:Math.round(1e3*l),buffering:s<=2?1:0,duration:Math.round(p),wait_duration:0,cur_cache_duration:(0,ee.L8)(i),local_time_ms:Date.now(),volume_level:d,volume_change:0,muted:u?1:0,click_mute:0,session_order:0,play_size:Math.round(y),data_player_type:2,cache_size:0,cache_duration:0,cdn_size_video:0,is_bytevc1:n?1:0,drop_frame:0,total_play_frame:0,drop_frame_rate:0,drop_frame_duration:0},H),_=(0,ee.Ug)(r),m=Object.assign(Object.assign({vid:A,playPos:Math.round(1e3*l),stayDuration:0,videoQuality:1},_),{logid:(null==R?void 0:R.log_id)||"nonw"});null==g||g(m),c.f.event("video_play_end",f)},[H,U,$,V,R,I]),Y=(0,f.useCallback)(e=>{if((0,h.uQ)(y.Y.VideoFirstFrame),!H||1===I)return;const t=Object.assign({},{feed_total:e.duration},H),r=(0,h.xt)();c.f.event("first_feed_show_time",Object.assign(Object.assign({},t),r)),P&&P()},[H,I,P]),J=(0,f.useCallback)(e=>{if(!H||1===I)return;let t=0,a=!1;(null==r?void 0:r.attributes)&&(t=r.attributes.duration,a=r.attributes.muted);const i=$(),o=U(),l=Object.assign({},o,{duration:Math.round(e.duration),is_bytevc1:i?1:0,video_duration:Math.round(1e3*t),muted:a?1:0,bitrate_set:(0,ee.OK)(n),quality_bitrate:(0,ee.n2)(n),duration_from_load:Math.round((null==e?void 0:e.durationFromLoaded)||0),duration_with_load:Math.round((null==e?void 0:e.durationWithLoaded)||0),is_same:0,retry_c:e.retryCount||0,retry_l:e.retryList||[]},H);c.f.event("video_play_quality",l)},[H,$,n,U,I]),Z=(0,f.useCallback)(e=>{if(!H||1===I||(null==r?void 0:r.state)!==l.R.ACTIVE)return;const t=U();let n=0;(null==r?void 0:r.attributes)&&(n=r.attributes.currentTime);const a=$(),i=Object.assign({},t,{duration:Math.round(e.duration),is_bytevc1:a?1:0,position:Math.round(1e3*n),should_filter:"0",droppedRate:0,end_type:0,block_type:L.current},H);c.f.event("video_block",i)},[H,$,U,I]),re=(0,f.useCallback)(e=>{e.preventDefault()},[]),ne=(0,f.useCallback)(()=>{(0,h.uQ)(y.Y.VideoCanPlay),null==a||a()},[a]),ae=(0,f.useCallback)(e=>{null==v||v(e)},[v]),ie=(0,f.useCallback)(e=>{null==_||_(e)},[_]),oe=(0,f.useCallback)(e=>{null==i||i(e)},[i]),le=(0,f.useCallback)(e=>{null==d||d(e)},[d]),se=(0,f.useCallback)(e=>{null==u||u(e)},[u]),de=(0,f.useCallback)(()=>{null==p||p()},[p]),ue=(0,f.useCallback)(e=>{null==S||S(e)},[S]),ce=(0,f.useCallback)(e=>{null==T||T(e)},[T]),pe=(0,f.useCallback)(e=>{null==k||k(e)},[k]),ve=(0,f.useCallback)(e=>{null==m||m(e)},[m]),he=(0,f.useCallback)(e=>{e.id=A,null==b||b(e)},[b,A]);return(0,f.useEffect)(()=>()=>{(null==r?void 0:r.metrics)&&r.metrics.stop()},[A]),(0,f.useEffect)(()=>{if(null==r?void 0:r.metrics)return r.metrics.bind("PlayEnded",X),()=>{r.metrics&&r.metrics.clear("PlayEnded")}},[X]),(0,f.useEffect)(()=>{if(null==r?void 0:r.metrics)return r.metrics.on("VideoRequest",z),r.metrics.on("VideoRequestResponse",W),r.metrics.on("BlockStart",G),r.metrics.on("Block",Z),r.metrics.on("PlayQuality",J),r.metrics.on("PlayFailed",K),r.metrics.on("FirstFrame",Y),r.element&&r.element.addEventListener("contextmenu",re),r.event&&(r.event.on("canplay",ne),r.event.on("play",oe),r.event.on("waiting",le),r.event.on("ended",se),r.event.on("timeupdate",de),r.event.on("error",ue),r.event.on("pause",ce),r.event.on("playing",pe),r.event.on("loadstart",ae),r.event.on("loadeddata",ie),r.event.on("volumechange",ve),r.event.on("resolutionReady",he)),()=>{r.metrics&&(r.metrics.off("VideoRequest",z),r.metrics.off("VideoRequestResponse",W),r.metrics.off("BlockStart",G),r.metrics.off("Block",Z),r.metrics.off("PlayQuality",J),r.metrics.off("PlayFailed",K),r.metrics.off("FirstFrame",Y),r.element&&r.element.removeEventListener("contextmenu",re),r.event&&(r.event.off("canplay",ne),r.event.off("play",oe),r.event.off("waiting",le),r.event.off("ended",se),r.event.off("timeupdate",de),r.event.off("error",ue),r.event.off("pause",ce),r.event.off("playing",pe),r.event.off("loadstart",ae),r.event.off("loadeddata",ie),r.event.off("volumechange",ve),r.event.off("resolutionReady",he)))}},[oe,ne,le,se,de,ue,ce,pe,ae,ie,z,W,G,Z,J,K,Y,re,a,v,_,he]),(0,o.FD)("div",{id:e,className:t.join(" "),ref:j,children:[O?(0,o.Y)("track",{default:!0,kind:"subtitles",srcLang:O.language,src:O.url}):null,(0,w.xk)()?(0,o.FD)("div",{style:te,children:[null==r?void 0:r.uuid,"_",null==r?void 0:r.state,D?"_hitPreload":""]}):null]})})),ne={playerReuse:"v0",playerPreload:{vid:"v0",maxQueueCount:3,preloadMaxCacheCount:5,preloadTime:10,segmentMinDuration:10,minBufferLength:10,startPreloadControl:!1,startPreloadMinBuffer:0,startPreloadMinPosTime:0},hevcIgnoreEnv:1,hevcResultLocal:0,bitrateSelect:{vid:"v0",selector:"default",qualityType:20,hevcQualityType:14},playerUpgrade:{vid:"v0",playerType:"XG",preload:{},playerConfig:{},maxCacheCount:5},playerH265Soft:{vid:"v0",enableSoftwareH265:0,config:void 0},playerOpenMse:"v0",useAddrList:0,playerHevc:"v0",cthunPredictBufferWithLinear:!1,cthunPredictBufferWithPoly:!1,cthunPredictBufferWithTree:!1},ae={Chrome:{cpuCore:0,dScore:0,score:-2,gpuScore:0,hevcQualityType:14,checkLevel:2,pageNames:["video_detail","homepage_hot","homepage_follow","others_homepage","explore_page"],playModes:["video_detail","one_column","browser_mode","immersive_player","three_column"]},Edge:{cpuCore:0,dScore:0,score:-2,gpuScore:0,hevcQualityType:14,checkLevel:2,pageNames:["video_detail","homepage_hot","homepage_follow","others_homepage","explore_page"],playModes:["video_detail","one_column","browser_mode","immersive_player","three_column"]}};var ie=r(39333);const oe="PlayerLife",le="PlayerCall",se=(e,t)=>{var r,n,a,i,o,l,s,d,u,c,p,v;const h=null!==(n=null===(r=null==e?void 0:e.element)||void 0===r?void 0:r.error)&&void 0!==n?n:null,y=null===(a=null==e?void 0:e.element)||void 0===a?void 0:a.buffered,f=null==e?void 0:e.currentTime,_=null==e?void 0:e.type,m=(null==e?void 0:e.curDefinition)||{};return{buffered:y,currentTime:f,ended:null===(i=null==e?void 0:e.element)||void 0===i?void 0:i.ended,currentSrc:null!=t?t:null===(o=null==e?void 0:e.element)||void 0===o?void 0:o.currentSrc,duration:null==e?void 0:e.duration,readyState:null===(l=null==e?void 0:e.element)||void 0===l?void 0:l.readyState,networkState:null===(s=null==e?void 0:e.element)||void 0===s?void 0:s.networkState,error:h?{code:null==h?void 0:h.code,message:null!==(u=null===(d=null==e?void 0:e.element)||void 0===d?void 0:d.error)&&void 0!==u?u:(null==h?void 0:h.message)||"UNKNOWN_ERROR_MESSAGE",MEDIA_ERR_ABORTED:1,MEDIA_ERR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4}:null,playerType:_,volume:null==e?void 0:e.volume,muted:null==e?void 0:e.muted,videoBitrate:null==m?void 0:m.bitrate,videoQuality:null==m?void 0:m.definition,codecType:null!==(c=null==m?void 0:m.codecType)&&void 0!==c?c:"h264",play_url:null!==(v=null===(p=null==e?void 0:e.element)||void 0===p?void 0:p.currentSrc)&&void 0!==v?v:t}},de=(0,f.memo)((0,f.forwardRef)(function({id:e,url:t,mode:r,muteSetting:n,playProgress:a,duration:b,playbackRate:I=1,onLoadStart:A,onLoadedData:j,onCanPlay:D,onPause:H,onPlay:te,onPlaying:de,onTimeUpdate:ue,onWaiting:ce,onEnded:pe,onError:ve,onUnmount:he,onVideoChange:ye,onBreak:fe,onVideoVolumeChange:_e,onVideoPlayEnd:me,onAutoplayPrevented:ge,onResolutionReady:be,onFirstFrame:Pe,userResolution:Se,subtitleStruct:Te,subtitleList:ke,curSubtitle:Ce,onSubtitleCallback:we=e=>{},bitrateInfo:Oe,defaultDefinition:Re,preloadUrlsList:Me,preloader:Ee,defaultBitrate:Ie=-1,playerInitHost:Ae,teaParams:je,autoPlay:De,autoReplay:xe=!0,size:He,pathId:Le="",metrics:Fe,playbackAbTestInfo:Ve=ne,isTTP:qe,videoDimensionParams:Be,vIndex:Qe=-1,extInfo:Ne={},renderState:Ue=l.R.ACTIVE,volumeInfo:$e,urlList:ze},We){const[Ge,Ke]=(0,f.useState)(null),Xe=(0,f.useRef)(null),Ye=(0,f.useRef)((new Date).getTime()),Je=(0,f.useRef)(!1),Ze=(0,f.useRef)(0),et=(0,f.useRef)(null),tt=(0,f.useRef)(),rt=(0,f.useRef)(null),nt=(0,f.useRef)(function(){if(q)return q;const e={playerType:"",videoPlayMode:"",preloader:""},t=(location.search||"").replace("?","").split("&");for(let r=0;r<t.length;r++){const n=t[r].split("=");void 0!==V[n[0]]&&(e[V[n[0]]]=n[1])}return q=e,e}()),at=(0,f.useRef)(Ue),it=(0,f.useRef)(!1),ot=(0,f.useRef)(null),lt=(0,p.Ul)(),st=(0,f.useRef)(!1),dt=(0,f.useRef)(null),[ut,ct]=(0,f.useState)(!1);!function(e){e&&(U=e)}(Ae);const[pt,vt]=(0,f.useState)(!1),ht=(0,v.i3)(),yt=1===r?n:n||ht;const ft=(0,v.R4)(),_t=(0,v.S4)().setMute,mt=(0,ee.AI)(r);s.M.playMode=mt,s.M.pageName=Le;let gt=s.M.checkHevcResult(!0);const bt=null==Ve?void 0:Ve.playerH265Soft,Pt=(0,f.useCallback)((e,t)=>{var n,a,i,o,s,d;const u={mode:r,pathId:Le};if("MP4_2"===e){if(et.current)try{const e=null===(n=et.current)||void 0===n?void 0:n.element;Object.assign(u,{currentTime:null!==(a=null==e?void 0:e.currentTime)&&void 0!==a?a:0,codec:null!==(s=null===(o=null===(i=et.current)||void 0===i?void 0:i.curDefinition)||void 0===o?void 0:o.codecType)&&void 0!==s?s:"",duration:null!==(d=null==e?void 0:e.duration)&&void 0!==d?d:0})}catch(e){console.error("playCatch error")}!function(e,t){var r,n,a,i,o,l,s,d,u;const c={code:null!==(r=t.errorCode)&&void 0!==r?r:0,message:null!==(n=t.errorMessage)&&void 0!==n?n:"",httpCode:null!==(a=t.httpCode)&&void 0!==a?a:0,url:null!==(i=t.url)&&void 0!==i?i:"",type:e,responseMsg:"",xCache:"",via:"",mode:null!==(o=t.mode)&&void 0!==o?o:"",pathId:null!==(l=t.pathId)&&void 0!==l?l:"",currentTime:null!==(s=t.currentTime)&&void 0!==s?s:0,codec:null!==(d=t.codec)&&void 0!==d?d:"",duration:null!==(u=t.duration)&&void 0!==u?u:0};(null==t?void 0:t.response)?function(e){const t={responseMsg:""};return new Promise(r=>{try{e.headers.forEach((e,r)=>{t[r.toLocaleLowerCase()]=e}),e.text().then(n=>{e.text=n;const a=n.toLocaleLowerCase(),i=/<body>(([\s\S])*?)<\/body>/.exec(a),o=document.createElement("div");o.innerHTML=i?i[1]:"";const l=o.children;let s="";for(let e=0;e<l.length;e++)s+=`${l[e].innerText}|`;t.responseMsg=s,r(t)}).catch(()=>{r(t)})}catch(e){r(t)}})}(t.response).then(t=>{var r,n,a;c.responseMsg=null!==(r=t.responseMsg)&&void 0!==r?r:"",c.xCache=null!==(n=t["x-cache"])&&void 0!==n?n:"",c.via=null!==(a=t.via)&&void 0!==a?a:"",console.info(`>>>>>${e} parseResponse`,c),(0,ie.Q)(c)}).catch(()=>{c.code=-1e3,(0,ie.Q)(c),console.info("parse response error")}):(0,ie.Q)(c)}("running",Object.assign(t,u))}(0,w.AX)(t)&&W(it.current,l.c.H264)},[e,r,Le,rt]),St=(0,f.useCallback)(()=>{null==ge||ge()},[e,r,Le]);(0,f.useEffect)(()=>{var e,t;(0,k.Cd)(null!==(e=null==lt?void 0:lt.id)&&void 0!==e?e:""),Ee.setPreloadIndex(null!==(t=null==lt?void 0:lt.index)&&void 0!==t?t:0)},[lt]),(0,f.useEffect)(()=>{s.a.getInstance().needPersist=!0,s.M.setHevcEffectiveConditions(ae),gt=s.M.checkHevcResult(!0);const{playerReuse:e,playerHevc:t="v0"}=Ve;x.setPlayerH265SoftInfo(bt),(0,w.Tb)("setPlayerH265SoftInfo0",null==bt?void 0:bt.enableSoftwareH265);const r=x.use(),n=x.canUse(),a=Z(t),i=gt.open||r||a?l.c.H265:l.c.H264,{playerUpgrade:o}=Ve;let u="XG";n||(u=(null==o?void 0:o.playerType)||nt.current.playerType||"XG"),it.current=u===l.P.NEW_TT,ot.current=function(e,t){let r=null;return e?(Q||(Q=new d.mx({enableReuse:!1,enableMultiple:!0,minBuffer:0,defaultMSE:!1})),r=Q):(B||(B=new d.SN({enableReuse:!1,enableMultiple:!0,minBuffer:0,defaultMSE:!1})),r=B),t&&r.setConfig({enableReuse:"v0"!==t,needReset:"v1"===t}),r}(it.current,n?"v0":e),(0,w.xk)()&&(window._multimediaPool=ot.current),W(it.current,i)},[]),(0,f.useEffect)(()=>{x.setPlayerH265SoftInfo(bt),(0,w.Tb)("setPlayerH265SoftInfo1",null==bt?void 0:bt.enableSoftwareH265);const t=x.canUse(),r=Z(Ve.playerHevc),n=gt.open||r||x.use()?l.c.H265:l.c.H264;if(it&&t){const e=N;d.IH.clearAll(l.P.NEW_TT),e&&z(!it.current,e);const t=null==et?void 0:et.current;t&&d.IH.attachPlayer(t),W(!it.current,n)}else W(it.current,n);(0,w.Tb)(le,"changePreloadCodec",e,n,gt.open,`state:${x.state}`,`isNewTT:${it.current} softHevcCanUse:${t}`,x.checkResult)},[e,gt.open,gt.openSrc,null==bt?void 0:bt.enableSoftwareH265,x.state]);const Tt=(0,f.useCallback)(e=>{var t;const r=e.player;if(!r)return;const n=r.element;(0,w.y8)(n)&&((e=>{const{H264DefinitionList:t}=e.config;if(t&&t.length>0){const r=t[0];e.emit("playCatch","MP4_3",{errorCode:8200,message:"width and height is 0"}),e.setConfig({defaultBitrate:r.bitrate,defaultDefinition:r.definition,url:r.url,codecType:r.codecType}),e.src=r.url,e.play()}})(r),W(it.current,l.c.H264)),null===(t=et.current)||void 0===t||t.off("loadedmetadata",Tt)},[e,r,Le,rt]),kt=t=>{(0,w.Tb)(le,"handlerPreloadInfoReady",t),(0,E.ZQ)().setPreloadCacheInfo(e,t),ct(!0)},Ct=(0,f.useMemo)(()=>ke&&ke.length>0?ke:[],[ke]),wt=(0,f.useMemo)(()=>Me.length,[e,Me]);(0,f.useEffect)(()=>{const{playerPreload:t}=Ve,r="number"==typeof(n=(null==t?void 0:t.vid)||"v0")?n:"boolean"==typeof n?n?1:0:0===n.indexOf("v")&&2===n.length?parseInt(n[1],10):parseInt(n,10);var n;const a=x.use();(0,w.Tb)(oe,"addPreloadList",e,a,Me.map(e=>e[0].id)),r>0&&z(!a&&it.current,Me)},[e,wt]),(0,f.useEffect)(()=>{var e,t,r,n,a;Ct.length>0?(tt.current?tt.current.setSubTitles(Ct):(tt.current=new d.SX({subTitlesList:Ct}),null===(e=tt.current)||void 0===e||e.on("update",e=>{we(e)}),null===(t=tt.current)||void 0===t||t.on("change",e=>{we(e)}),null===(r=tt.current)||void 0===r||r.on("error",e=>{we(e)})),et.current&&tt.current.attach(null===(n=et.current)||void 0===n?void 0:n.element)):null===(a=tt.current)||void 0===a||a.switchOff()},[Ct,e]),(0,f.useEffect)(()=>{var e,t;Ce?null===(t=tt.current)||void 0===t||t.switch(Ce):null===(e=tt.current)||void 0===e||e.switchOff()},[Ce,e]),(0,f.useEffect)(()=>{et.current&&(null==Fe||Fe.setPlayerType(it.current?l.P.NEW_TT:l.P.XG))},[Fe,Ge]),(0,f.useEffect)(()=>{var t,r;(0,w.Tb)(oe,"renderState",null===(t=et.current)||void 0===t?void 0:t.uuid,e,Ue,yt,ft);let n=Ue;const a=at.current;if(et.current){Ue===l.R.BACKUP&&(n=l.R.RETAIN),at.current=n;const e=ot.current;null==e||e.updatePlayer(et.current,n),X(n)&&De&&(et.current.play(),et.current.forceAutoplay=!0),n!==l.R.ACTIVE&&et.current.pause()}else Ue===l.R.RETAIN&&(n=l.R.BACKUP),at.current=n;(0,w.Tb)(oe,null===(r=et.current)||void 0===r?void 0:r.uuid,e,"renderStateChange",e,`renderState:${Ue} preState:${a} state:${n} muted:${yt} volume:${ft} autoplay:${De}`)},[Ue]),(0,f.useEffect)(()=>{var r;if(!Ge){const n={vIndex:Qe,extInfo:Object.assign(Object.assign({},Ne),{log_id:(null==je?void 0:je.log_id)||"none",is_ad:(null==je?void 0:je.isAd)?1:0})},{useAddrList:i=0}=Ve,o=i>0&&ze&&ze.length>0?ze:t,l=function(e,t,...r){return e?function(e=[],t=0,r,n,a=0,i=!0,o,l,d,u,c,p,v,h,y,f,m,g,b){var P,S,k,C;const{channelInfo:O,regionInfo:E}=s.M.getInstance(),I=Z(null==y?void 0:y.playerHevc),A=(null==v?void 0:v.open)||I?"h265":"h264",j=n,D=G(e,{defaultBitrate:t,defaultDefinition:r,url:u}),{h264Set:H,h265Set:F}=(0,M.cU)(e);let V="";u&&(V=L(Y(u),U.group1,U.group2));const q=V===_?{credentials:"include"}:{},B={channel:null==O?void 0:O.channel,channel_domain:null==O?void 0:O.domain,channel_type:null==O?void 0:O.type},Q=(null==E?void 0:E.region)||"",N=(null==E?void 0:E.wid)||"",$=(null==E?void 0:E.isLogin)||!1,z=(null==y?void 0:y.playerPreload)||{},W=(null==c?void 0:c.extInfo)||{},X=null==y?void 0:y.bitrateSelect,ee=(null===(P=null==y?void 0:y.playerUpgrade)||void 0===P?void 0:P.playerConfig)||(null===(S=null==y?void 0:y.playerUpgrade)||void 0===S?void 0:S.multiplexConfig)||{},te=(null===(k=null==y?void 0:y.playerUpgrade)||void 0===k?void 0:k.mp4ParserConfig)||{},re=(null===(C=null==y?void 0:y.playerUpgrade)||void 0===C?void 0:C.maxCacheCount)||0,ne=J(y),ae={selector:(null==X?void 0:X.selector)||"default",selectConfig:(null==X?void 0:X.config)||{},quality:(null==X?void 0:X.qualityType)||20,hevcQuality:(null==X?void 0:X.hevcQualityType)||14};(0,w.Tb)("generatePlayerConfigTT",j,D,ae);const ie=s.a.getHevcDisableInfo(),oe=x.getStats();let le=T();return(le<=0||le>50)&&(le=10),{playerType:"NEW_TT",playerConfig:{autoplay:i,volume:l,muted:d,playbackRate:1,codecType:A,vtype:"MP4",startTime:g||0,mp4EncryptPlayer:{closeDowngrade:!1,minBufferLength:le,maxBufferLength:30,needPreloadRangeList:!0,needPreloadCheck:!0,needAutoBitrate:!0,removeBufferLen:60,resumePlayWaterLevel:0,segmentMinDuration:10,reqOptions:q,getRequestOptionsCallback:K},getRequestOptionsCallback:K},strategyConfig:{enableSubtitle:!0,enablePreloader:"0"!==(null==b?void 0:b.preloader),enableLogger:!0,preloaderConfig:Object.assign(Object.assign({minBufferLength:le,preloadCacheType:1,preloadMaxCacheCount:5,preloadTime:le,preloadSize:209715,segmentMinDuration:10,reqOptions:q},z),{getRequestOptionsCallback:K}),bitrateAdapter:Object.assign(Object.assign({},ae),{hevcQuality:28,quality:20,userSelectResolution:f||"auto"}),videoPlayMode:ne,multiplexConfig:ee,mp4ParserConfig:te,maxCacheCount:re},videoInfo:{vid:j,groupId:j,vtype:"MP4",codecType:"h264",definition:r||"",bitrate:t,width:0,height:0,url:u,duration:a,bitrateList:D,vqscore:null!=p?p:0,mvmaf:"",volumeInfo:m},loggerParams:{lineAppId:1988,playerCoreVersion:"",codec_type:A,tag:s.M.pageName,preTag:s.M.prePageName,preSubtag:s.M.prePlayMode,subtag:s.M.playMode,vid:n,region:Q,webId:N,uid:(null==E?void 0:E.uid)||N,isLogin:$,channelConfig:B,switchPlayerTime:h,bitrateSet:H,bitrateSetHevc:F,pIndex:(null==c?void 0:c.vIndex)||-1,ext:Object.assign(Object.assign(Object.assign(Object.assign({},W),ie),{log_id:(null==o?void 0:o.log_id)||"",is_ad:(null==o?void 0:o.isAd)?1:0}),oe),deviceScore:s.b.shortData,strategyVersion:R.v},envInfo:{tag:s.M.pageName,subtag:s.M.playMode,preTag:s.M.prePageName,preSubtag:s.M.prePlayMode,isLogin:$}}}(...r,t):function(e=[],t=0,r,n,a=0,i=!0,o,l,u,c,p,v,h,y,f,m,g,b,P){var S;const{channelInfo:k,regionInfo:C}=s.M.getInstance(),O=Y(c),E=t,I=x.use(),A=Z(null==f?void 0:f.playerHevc),j=(null==h?void 0:h.open)||A||I?"h265":"h264",D=`${n}`,H=d.IH.getPreloadMeta(D),V=(0,w.J)(o),q=G(e,{defaultBitrate:t,defaultDefinition:r,url:c}),{h264Set:B,h265Set:Q}=(0,M.cU)(e),N=O;let $="";O&&($=L(O,U.group1,U.group2));const z=$===_?{credentials:"include"}:{},W={channel:null==k?void 0:k.channel,channel_domain:null==k?void 0:k.domain,channel_type:null==k?void 0:k.type},X=(null==C?void 0:C.region)||"",ee=(null==C?void 0:C.wid)||"",te=(null==C?void 0:C.isLogin)||!1,re=(null==f?void 0:f.playerPreload)||{},ne=(null==p?void 0:p.extInfo)||{},ae=null==f?void 0:f.bitrateSelect,ie=(null===(S=null==f?void 0:f.playerH265Soft)||void 0===S?void 0:S.disableResolution)||[],oe=J(f),le={selector:(null==ae?void 0:ae.selector)||"default",selectConfig:(null==ae?void 0:ae.config)||{},quality:(null==ae?void 0:ae.qualityType)||20,hevcQuality:(null==ae?void 0:ae.hevcQualityType)||14};(0,w.Tb)("generatePlayerConfig",D,q,le);const se=s.a.getHevcDisableInfo(),de=x.getStats();let ue=T();return(ue<=0||ue>50)&&(ue=10),{enableSubtitle:!0,enablePreloader:"0"!==(null==P?void 0:P.preloader),enableLogger:!0,preloader:Object.assign(Object.assign({minBufferLength:ue,preloadCacheType:1,preloadMaxCacheCount:5,preloadTime:ue,preloadSize:209715,segmentMinDuration:10,reqOptions:z},re),{getRequestOptionsCallback:K}),mp4EncryptPlayer:{closeDowngrade:!1,minBufferLength:ue,maxBufferLength:30,needPreloadRangeList:!0,needPreloadCheck:!("MSE"===oe),needAutoBitrate:!0,removeBufferLen:60,resumePlayWaterLevel:0,segmentMinDuration:10,h265Degrade:!0,reqOptions:z,getRequestOptionsCallback:K},logger:{appId:548444,line_app_id:1988,playerCoreVersion:"",codec_type:j,tag:s.M.pageName,preTag:s.M.prePageName,preSubtag:s.M.prePlayMode,subtag:s.M.playMode,vid:n,region:X,webId:ee,uid:(null==C?void 0:C.uid)||ee,isLogin:te,channelConfig:W,switchPlayerTime:y,bitrateSet:B,bitrateSetHevc:Q,pIndex:(null==p?void 0:p.vIndex)||-1,ext:Object.assign(Object.assign(Object.assign(Object.assign({},ne),se),{log_id:(null==o?void 0:o.log_id)||"",is_ad:(null==o?void 0:o.isAd)?1:0}),de),deviceScore:s.b.shortData,strategyVersion:R.v},video:{codecType:j,defaultBitrate:E,defaultDefinition:V,definitionList:[],duration:a,autoplay:i,volume:null!=l?l:.7,muted:u||!1,vqscore:null!=v?v:0,mvmaf:"",volumeInfo:g},extra:{url:O,actualUrl:N,vid:D,ignores:["play","start"],reqAuth:$,closeMSE:"H5"===oe||!F(H),startTime:b||0},hevcResult:h,bitrateList:q,bitrateAdapter:Object.assign(Object.assign({},le),{hevcQuality:14,quality:20,userSelectResolution:m||"auto"}),enableHevcSoftwareDecode:I,softHevcDisableResolution:ie}}(...r,t)}(it.current,nt.current,Oe,Ie,Re,e,b,De,je,ft,yt,o,n,0,gt,Ye.current,Ve,Se,$e,a||0);st.current=!1,dt.current=null,Xe.current=l;const u=ot.current,p=u.usePlayer(l,at.current);u.mountDom(p,rt.current),z(it.current,Me),(0,w.Tb)(oe,"usePlayer",p.uuid,e,`autoPlay:${De} volume:${ft} mute:${yt} playMode:${mt}`,l,mt,Le,gt,bt,`enableHevcSoftwareDecode:${l.enableHevcSoftwareDecode}`,`playProgress:${a}`),"three_column"===mt&&(p.objectFit="cover"),p.on("playCatch",Pt),p.on("autoplay_was_prevented",St),p.on(m,kt),p&&(et.current=p,null===(r=tt.current)||void 0===r||r.attach(p.player),Ke("xgplayer")),O.DS.setCustomTracker({event:(e,t)=>{c.f.event(e,t)}}),u.setCustomTracker({event:(e,t)=>{(0,w.Tb)("VodLogger",e,t),c.f.event(e,t)}})}},[He,e,t,r,Ee,_t,Re,qe]),(0,f.useEffect)(()=>{var e;if(Ge&&et.current){const t=e=>{e.cdn_speed&&(Ve.cthunPredictBufferWithLinear?function(e){const t=P(e);S=Math.round(-.410433*t+21.36258)}(e.cdn_speed):Ve.cthunPredictBufferWithPoly?function(e){const t=P(e);S=Math.round(-1.099049*t+.016635*Math.pow(t,2)+24.571243)}(e.cdn_speed):Ve.cthunPredictBufferWithTree&&function(e){const t=P(e);S=t<=20?t<=5.75?Math.round(22):Math.round(17):t<=35?Math.round(5):Math.round(8)}(e.cdn_speed));const t={task_type:1,cdn_size:e.cdn_size,cdn_speed:e.cdn_speed,project:"webapp-desktop"};(0,C.k)(t),null==Fe||Fe.videoQualityReport.msePlayerCacheUpdate(e.cdn_size)};return null===(e=et.current)||void 0===e||e.on("prf_data_size",t),()=>{var e;null===(e=et.current)||void 0===e||e.off("prf_data_size",t)}}},[Ge,Fe,Ve]);const Ot=(0,f.useCallback)(e=>{null==te||te(e)},[te]),Rt=(0,v.VN)();(0,f.useImperativeHandle)(We,()=>{const n=et.current;return{play:()=>(0,i.__awaiter)(this,void 0,void 0,function*(){var e,t;if((0,w.Tb)(le,"play",null===(e=et.current)||void 0===e?void 0:e.uuid,at.current,!X(at.current)),!et.current||!X(at.current))return Promise.resolve();try{yield null===(t=et.current)||void 0===t?void 0:t.play()}catch(e){console.info("Video play error: ",e)}}),pause:()=>{var t,n;(0,w.Tb)(le,"pause",null===(t=et.current)||void 0===t?void 0:t.uuid,at.current);try{null===(n=et.current)||void 0===n||n.pause(),u.A.emit("video_pause",{itemId:e,playMode:r})}catch(e){console.info("Video pause error: ",e)}},seek:t=>{if((0,w.Tb)(le,"seek",t),n){u.A.emit("video_seek",{itemId:e,playMode:r});const a=n.duration;a&&et.current&&et.current.seek(a*t)}},seekTime:e=>{null==n||n.seek(e)},onSeeked:e=>{null==n||n.on("seeked",e)},onSeeking:e=>{null==n||n.on("seeking",e)},onTimeUpdate:e=>{null==n||n.on("timeupdate",()=>{var t,r;const a=null!==(t=null==n?void 0:n.currentTime)&&void 0!==t?t:0,i=null!==(r=null==n?void 0:n.duration)&&void 0!==r?r:0;e(a/i,a,i)})},onCanPlay:e=>{null==n||n.on("canplay",e)},getFullscreen:e=>(0,i.__awaiter)(this,void 0,void 0,function*(){yield null==n?void 0:n.enterFullscreen(e)}),exitFullscreen:e=>(0,i.__awaiter)(this,void 0,void 0,function*(){yield null==n?void 0:n.exitFullscreen(e)}),getPlayerAttributes:()=>se(n,t),replay:()=>{(null==n?void 0:n.replay)&&(null==n||n.replay())},getPlaybackQuality:()=>{var e;return null===(e=null==n?void 0:n.element)||void 0===e?void 0:e.getVideoPlaybackQuality()},updatePlayer:e=>{var t;et.current&&(null===(t=ot.current)||void 0===t||t.updatePlayer(et.current,Ue))},changeResolution:e=>{var t;et.current&&(null===(t=ot.current)||void 0===t||t.changeResolution(et.current,e))},getResolutionInfo:()=>{var e;return et.current?null===(e=ot.current)||void 0===e?void 0:e.getResolutionInfo(et.current):null},get renderState(){return at.current}}});const Mt=(0,f.useCallback)((e=0)=>(0,i.__awaiter)(this,void 0,void 0,function*(){var t,r,n,a,o;if(X(at.current)&&!(e>=3))try{const e=null===(t=et.current)||void 0===t?void 0:t.player;(null==e?void 0:e.isCanplay)?yield null===(r=et.current)||void 0===r?void 0:r.play():null===(n=et.current)||void 0===n||n.on("canplay",()=>(0,i.__awaiter)(this,void 0,void 0,function*(){var e;X(at.current)&&(yield null===(e=et.current)||void 0===e?void 0:e.play())}))}catch(t){const r=null!==(a=null==t?void 0:t.message)&&void 0!==a?a:"",n=r.indexOf("new load request")>-1,i=null!==(o=r.match("failed because the user didn't interact with the document first."))&&void 0!==o?o:r.match("The request is not allowed by the user agent or the platform in the current context");if(n)return;i?(_t(!0),setTimeout(()=>{Mt(e+1)},0)):Mt(e+1)}}),[_t]),Et=(0,f.useCallback)(()=>{var t,n;try{(null===(t=et.current)||void 0===t?void 0:t.replay)&&(null===(n=et.current)||void 0===n||n.replay()),u.A.emit("video_replay",{itemId:e,playMode:r})}catch(e){setTimeout(()=>{_t(!0)},0)}},[_t,e,r]);(0,f.useEffect)(()=>{Ge&&et.current&&X(at.current)&&(et.current.volume=ft,et.current.muted=yt,et.current.playbackRate=I,null==_e||_e(yt?0:ft))},[Ge,yt,I,ft,_e]),(0,f.useEffect)(()=>{const t=et.current;if(!Ge||!t||!X(at.current))return;const n="undefined"!=typeof document&&!document.hidden;De&&Ge&&(7===r||n)&&Mt(),(0,w.Tb)("videoCanplay",e,t.uuid,t.currentTime,a,`videoCanplay:${pt} autoPlay:${De}`),3!==r&&t&&Math.abs(t.currentTime-a)>.2&&pt&&t.seek(a)},[pt,De,a,Mt,Ge,r]);const It=(0,f.useCallback)(e=>{var t;(0,w.Tb)("callback handlePlayerWaiting",null===(t=et.current)||void 0===t?void 0:t.uuid),Ge&&(null==ce||ce(e))},[Ge,ce]),At=(0,f.useCallback)(()=>{Ge&&(null==fe||fe())},[Ge,fe]),jt=(0,f.useCallback)(e=>{var t;(0,w.Tb)("callback handlePlayerEnded",null===(t=et.current)||void 0===t?void 0:t.uuid),Ge&&(null==pe||pe(e),xe&&Et())},[Ge,pe,Et,xe]),Dt=(0,f.useCallback)(e=>{var t,r,n;(0,w.Tb)("callback handleLoadStart",null===(t=et.current)||void 0===t?void 0:t.uuid);const a=null===(r=et.current)||void 0===r?void 0:r.element,i=a?null==a?void 0:a.style.background:null;st.current&&(null===(n=null==et?void 0:et.current)||void 0===n?void 0:n.element)&&(dt.current=i||"",et.current.element.style.background="#000"),null==A||A(e)},[A]),xt=(0,f.useCallback)(e=>{var t;(0,w.Tb)("callback handleLoadedData",null===(t=et.current)||void 0===t?void 0:t.uuid),st.current=!0,null==j||j(e)},[j]),Ht=(0,f.useCallback)(e=>{if(!et.current||!X(at.current))return;const{volume:t,muted:r}=et.current;X(at.current)&&r&&_t(!0),null==_e||_e(r?0:t)},[_e]),Lt=(0,f.useCallback)(()=>{null==ue||ue()},[ue]),Ft=(0,f.useCallback)(e=>{var t;(0,w.Tb)("handleError",null===(t=et.current)||void 0===t?void 0:t.uuid,e),null==ve||ve(e)},[ve]),Vt=(0,f.useCallback)(()=>{var e;null==D||D(),vt(!0);const t=dt.current;(null===(e=null==et?void 0:et.current)||void 0===e?void 0:e.element)&&null!==t&&(et.current.element.style.background=t,dt.current=null)},[D]),qt=(0,f.useCallback)(e=>{var t;(0,w.Tb)("callback handlePause",null===(t=et.current)||void 0===t?void 0:t.uuid),null==H||H(e)},[H]),Bt=(0,f.useCallback)(e=>{var t;(0,w.Tb)("callback handlePlaying",null===(t=et.current)||void 0===t?void 0:t.uuid),null==de||de(e)},[de]),Qt=(0,f.useCallback)(t=>{var n;(0,w.Tb)(le,"handlePrevention",null===(n=et.current)||void 0===n?void 0:n.uuid,e,at.current),Ge&&setTimeout(()=>{try{if(!X(at.current))return;if(Ze.current>=3)return void(null==ge||ge());if("xgplayer"===Ge||!(null==t?void 0:t.errorName)||"NotAllowedError"===(null==t?void 0:t.errorName)){if(7===r)return void qt(t);_t(!0);const e=et.current;et.current&&(et.current.muted=!0),null==e||e.play()}Ze.current+=1}catch(e){console.error("handle autoplay error",e)}},0)},[Ge,r]);return(0,f.useEffect)(()=>{if(!Ge)return;const e=et.current;return null==e||e.on(g,Qt),()=>{var e;(null===(e=et.current)||void 0===e?void 0:e.element)&&et.current.off(g,Qt)}},[Ge,Qt]),(0,f.useEffect)(()=>{if(Ge)return()=>{var e;const t=et.current;(0,w.Tb)(oe,"release off events",null===(e=et.current)||void 0===e?void 0:e.uuid),t&&(t.off("playCatch",Pt),t.off(m,kt),t.off("autoplay_was_prevented",St))};((e,t)=>{const{playerPreload:r,playerUpgrade:n}=t,a=null==n?void 0:n.preload;d.IH.update(Object.assign(Object.assign({getRequestOptionsCallback:K},r),a),$(e)),(0,E.as)((null==r?void 0:r.maxQueueCount)||3),window.MultiMediaPreloader=d.IH})(it.current,Ve)},[Ge,Pt]),(0,f.useEffect)(()=>{var t,r;(0,w.Tb)(le,"playing",null===(t=et.current)||void 0===t?void 0:t.uuid,e,at.current,`playing:${Rt} isPausedForced:${Je.current}`),Rt?Je.current&&De&&(Je.current=!1,Mt()):(Je.current=!0,null===(r=et.current)||void 0===r||r.pause())},[De,Rt,Mt]),(0,f.useEffect)(()=>()=>{var e,t,r;const n=null===(r=null===(t=null===(e=et.current)||void 0===e?void 0:e.element)||void 0===t?void 0:t.getVideoPlaybackQuality)||void 0===r?void 0:r.call(t);n&&(null==Fe||Fe.updateFrameInfo({drop_frame:n.droppedVideoFrames,total_play_frame:n.totalVideoFrames,drop_frame_rate:n.droppedVideoFrames/n.totalVideoFrames,drop_frame_duration:n.creationTime}))},[]),(0,f.useEffect)(()=>()=>{(0,h.uQ)(y.Y.PlayerDestroy),he(se(et.current,t))},[]),(0,f.useEffect)(()=>{var n;return(0,w.Tb)(oe,"releasePlayer0",null===(n=et.current)||void 0===n?void 0:n.uuid,e),()=>{var n,a,i,o,l;const s=et.current;null===(n=null==s?void 0:s.metrics)||void 0===n||n.stop(),null==s||s.off("playCatch",Pt),null==s||s.off(m,kt),null==s||s.off("autoplay_was_prevented",St),(0,w.Tb)(oe,"releasePlayer1",null===(a=et.current)||void 0===a?void 0:a.uuid,e,at,t,r),null===(i=ot.current)||void 0===i||i.releasePlayer(et.current),null===(o=tt.current)||void 0===o||o.detach(),null===(l=tt.current)||void 0===l||l.destroy(),tt.current=null,vt(!1),et.current=null,null==ye||ye(!1)}},[]),(0,o.Y)(re,{containerId:`xgwrapper-${r}-${e}`,classList:["xgplayer-container","tiktok-web-player"],player:et.current,containerRef:rt,bitrateInfo:Oe,oncanplay:Vt,onplay:Ot,onwaiting:It,onended:jt,onbreak:At,ontimeupdate:Lt,onerror:Ft,onpause:qt,onplaying:Bt,onloadstart:Dt,onloadeddata:xt,onvolumechange:Ht,onVideoPlayEnd:me,onResolutionReady:be,onFirstFrame:Pe,subtitle:3===r&&Te?Te:void 0,teaParams:je,videoDimensionParams:Be,hitPreload:ut,mode:r,id:e})}))},87412:(e,t,r)=>{r.d(t,{Hg:()=>n,cU:()=>a});const n=({hevcTest:e,bitrateInfo:t,videoOrder:r,downgradeUrl:n,backupDomain:a=!1,codec:i="h264"})=>{var o;const{h264:l=[],h265:s=[]}=((e,t)=>{const r={};let n=e;return t&&(n=((e,t)=>{try{const r=(t,r)=>t[e[0].property]!==r[e[0].property]?"Bitrate"===e[0].property?"desc"===e[0].order?r.Bitrate-t.Bitrate:t.Bitrate-r.Bitrate:e[0].detail.indexOf(t[e[0].property])>=0&&e[0].detail.indexOf(r[e[0].property])>=0?e[0].detail.indexOf(t[e[0].property])-e[0].detail.indexOf(r[e[0].property]):e[0].detail.indexOf(t[e[0].property])>=0?-1:1:t[e[1].property]!==r[e[1].property]?"Bitrate"===e[1].property?"desc"===e[1].order?r.Bitrate-t.Bitrate:t.Bitrate-r.Bitrate:e[1].detail.indexOf(t[e[1].property])>=0&&e[1].detail.indexOf(r[e[1].property])>=0?e[1].detail.indexOf(t[e[1].property])-e[1].detail.indexOf(r[e[1].property]):e[1].detail.indexOf(t[e[1].property])>=0?-1:1:1;return t&&t.length>0?[...t].sort(r):void 0}catch(e){return void console.error("bitrateInfo is empty")}})(t,e)),n?(n.forEach(e=>{let{CodecType:t}=e;t.startsWith("h265")&&(t="h265"),r[t]||(r[t]=[]),r[t].push(e)}),r):r})(t,r),{qualityType:d=20,hevcQualityType:u=28}=e;let c=null,p="",v="h264";if(function(e,t,r){return e.length>0&&t&&"h265"===r}(s,e.open,i)&&(c=(({hevcQualityType:e,h265:t})=>{if(t){const r=e||28;t.sort((e,t)=>e.Bitrate-t.Bitrate);const n=t.find(e=>e.QualityType===r);if(n)return n;if(t.length>0)return t[0]}return null})({hevcQualityType:u,h265:s})),c?v="h265":c=(({qualityType:e,h264:t})=>{if(t&&t.length>0){const r=e||20;t.sort((e,t)=>e.Bitrate-t.Bitrate);let n=t.find(e=>e.QualityType===r);return n||(n=t[0]),n}return null})({qualityType:d,h264:l}),c){const e=(null===(o=c.PlayAddr)||void 0===o?void 0:o.UrlList)||[];if(e.length>0)return p=e.length>1&&a?e[1]:e[0],{src:p,bitrate:c.Bitrate||0,definition:c.GearName||"",codecType:v,finalBitrateInfo:[c]}}return{bitrate:0,definition:"",src:null!=n?n:"",codecType:"h264",finalBitrateInfo:void 0}},a=e=>{const t=[],r=[];return e&&e.forEach(e=>{const n={qualityType:e.QualityType,gearName:e.GearName};e.CodecType.indexOf("h265")>=0?r.push(n):t.push(n)}),{h264Set:t,h265Set:r}}},87507:(e,t,r)=>{var n,a;r.d(t,{AI:()=>i,H4:()=>u,L8:()=>s,OK:()=>o,Ug:()=>c,n2:()=>l}),function(e){e.PlayQuality="video_play_quality",e.PlayEnded="video_play_end",e.PlayFailed="video_play_failed",e.BlockStart="video_block_start",e.Block="video_block",e.Request="video_request",e.RequestResponse="video_request_response",e.FirstFrame="first_feed_show_time"}(n||(n={})),function(e){e[e.Public=0]="Public",e[e.Self=1]="Self",e[e.Friend=2]="Friend"}(a||(a={}));const i=(e=0)=>["one_column","three_column","browser_mode","video_detail","pip","fullscreen","creator_tab","mini_player","immersive_player"][e],o=e=>e?e.map(e=>e.GearName||""):null,l=e=>e?e.map(e=>e.QualityType&&e.Bitrate?`${e.QualityType}:${e.Bitrate}`:"").filter(e=>!!e):null,s=e=>{if(!e)return 0;let t=0;for(let r=0;r<e.length;r++)t+=e.end(r)-e.start(r);return Math.round(1e3*t)},d=new Map([[2,"adapt_lowest_1080p"],[3,"adapt_lower_1080p"],[4,"adapt_1080p"],[7,"adapt_lowest_1440p"],[10,"normal_720p"],[11,"low_720p"],[12,"adapt_high_720p"],[13,"adapt_higher_720p"],[14,"adapt_lower_720p"],[15,"adapt_lowest_720p"],[16,"higher_720p"],[17,"highest_720p"],[18,"adapt_720p"],[19,"adapt_low_720p"],[191,"lower_720p"],[20,"normal_540p"],[21,"adapt_lower_540p"],[22,"adapt_high_540p"],[23,"adapt_higher_540p"],[24,"lower_540p"],[25,"lowest_540p"],[26,"higher_540p"],[27,"highest_540p"],[28,"adapt_540p"],[29,"adapt_lowest_540p"],[291,"adapt_low_540p"],[30,"normal_480p"],[31,"low_480p"],[32,"high_480p"],[33,"medium_480p"],[34,"lower_480p"],[35,"lowest_480p"],[36,"higher_480p"],[37,"highest_480p"],[38,"adapt_480p"],[39,"adapt_lower_480p"],[391,"adapt_high_480p"],[40,"normal_360p"],[41,"low_360p"],[42,"high_360p"],[43,"medium_360p"],[44,"lower_360p"],[45,"lowest_360p"],[46,"higher_360p"],[47,"highest_360p"],[48,"adapt_360p"],[49,"adapt_lowest_360p"],[50,"adapt_high_360p"]]),u=(e,t)=>{if(!e)return t;if("string"==typeof e&&e.indexOf("xgpreload_config")>-1)return e;const r=Number(e);if(!d.has(r)){const t=String(e).match(/^([a-zA-Z]*)+_([0-9]+)_0$/i);return t?`${t[1]}_${t[2]}p`:`_${e}`}return d.get(r)};function c(e){var t,r;const n={isFinish:0,pt:0,vt:0,firstframeDuration:100,errorCode:0,errorMessage:"",codecType:"h264",resolution:"",url:""},a=null===(r=null===(t=null==e?void 0:e.player)||void 0===t?void 0:t.plugins)||void 0===r?void 0:r.xgVodLogger;if(null==a?void 0:a.getFinalInfo){const e=a.getFinalInfo();return Object.assign(Object.assign({},n),e)}return n}}}]);