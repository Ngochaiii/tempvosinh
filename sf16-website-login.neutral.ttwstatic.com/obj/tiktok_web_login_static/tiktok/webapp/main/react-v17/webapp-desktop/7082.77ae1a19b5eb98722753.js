"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[7082],{159:(e,t,n)=>{n.d(t,{$4:()=>w,Mu:()=>b,o$:()=>O});var s=n(1183),o=n(64388),i=n(57998),r=n(11229),a=n(65476),c=n(37783),p=n(36441),l=n(87215),u=n(23037),d=n(38335),m=n(48156),v=n(18499),y=n(54623),g=n(51425),f=n(35953);const h={nickname:"",replyId:void 0,replyToReplyId:void 0,position:-1},_=(0,s.p)("commentInputAtom@tiktok/webapp-atoms",{reply:Object.assign({},h),replyToOtherComment:Object.assign({},h),mentionUserList:[],isInputEmpty:!0,isReplyInputEmpty:!0,isInputFocus:!1,needClearInput:!1,needResetKeyword:!1,replyCid:""}),{useAtomService:b,useServiceDispatchers:w,useServiceState:O}=(0,o.i)(_,(e,t)=>({setReplyCid(e){t(_,t=>Object.assign(Object.assign({},t),{replyCid:e}))},setReply(e){t(_,t=>Object.assign(Object.assign({},t),{reply:null===e?Object.assign({},h):e}))},setReplyOptimize(e){t(_,t=>Object.assign(Object.assign({},t),{replyToOtherComment:e}))},setMentionUserList(e){t(_,t=>Object.assign(Object.assign({},t),{mentionUserList:null===e?[]:e}))},setIsReplyInputEmpty(e){t(_,t=>Object.assign(Object.assign({},t),{isReplyInputEmpty:e}))},setIsInputEmpty(e){t(_,t=>Object.assign(Object.assign({},t),{isInputEmpty:e}))},setIsInputFocus(e){t(_,t=>Object.assign(Object.assign({},t),{isInputFocus:e}))},setNeedClearInput(e){t(_,t=>Object.assign(Object.assign({},t),{needClearInput:e}))},setNeedResetKeyword(e){t(_,t=>Object.assign(Object.assign({},t),{needResetKeyword:e}))},publishComment(t){return n=this,s=void 0,h=function*(){const n=(0,d.T)(),s=e(_),o=e(c.Pu),{awemeId:h,inputText:b,textExtra:w,teaParams:O,isReplyComment:C,shouldOptimizeReply:x,isCommentRedesign:T}=t,{reply:j,replyToOtherComment:I}=s,L=C?I:j,{replyId:V,replyToReplyId:k,nickname:E,position:A}=L,S=o[h],F={aweme_id:h,text:b,reply_id:V,reply_to_reply_id:k,text_extra:JSON.stringify(w)},U=Boolean(E)&&!x||C;try{const{status_code:e,comment:t}=yield(0,p.lG)(F);if(e===l.s.Ok){const e=U?"0"===k?"reply":"reply_to_reply":"original",s=n(E?"comment_reply_success":"comment_post_success");m.F.destroy(),m.F.open({content:s,duration:3,getContainer:u.M,getContainerPosition:"fixed"}),i.ao.handlePostComment(Object.assign(Object.assign({},O),{comment_category:e,comment_id:t.cid}));const o=null==S?void 0:S.ad_info;if(o){const e=(0,r.n5)({ad_info:o,play_mode:O.play_mode});a.pg.handleComment(e)}}else e===l.s.CommentBanCode?(m.F.destroy(),m.F.open({content:n("comment_banned_toast"),duration:3,getContainer:u.M,getContainerPosition:"fixed"})):e?(m.F.destroy(),m.F.open({content:n("comment_post_failed"),duration:3,getContainer:u.M,getContainerPosition:"fixed"})):(m.F.destroy(),m.F.open({content:n("comment_nointernet_toast"),duration:3,getContainer:u.M,getContainerPosition:"fixed"}));if(e===l.s.Ok){const e=(0,y.OL)(),n=(0,c.ud)(),s=["comment","reply",t.reply_id],o=["comment",t.aweme_id];(0,v.unstable_batchedUpdates)(()=>{C&&x?(T&&((0,g.performManualOptimisticUpdate)(s,(0,f.qZ)({reply:t,parentCid:null!=V?V:""})),(0,g.performManualOptimisticUpdate)(o,(0,f.uv)({awemeId:h,parentCid:null!=V?V:""}))),this.setReplyCid(""),e.handleReplySuccess({comment:t,position:A})):U?(T&&((0,g.performManualOptimisticUpdate)(s,(0,f.qZ)({reply:t,parentCid:null!=V?V:""})),(0,g.performManualOptimisticUpdate)(o,(0,f.uv)({awemeId:h,parentCid:null!=V?V:""}))),this.setNeedClearInput(!0),e.handleReplySuccess({comment:t,position:A})):(this.setNeedClearInput(!0),T&&(0,g.performManualOptimisticUpdate)(o,(0,f.nK)({comment:t})),e.handlePostSuccess(t)),n.addMlModelTrainData({id:h,action:"post_comment"})})}}catch(e){}},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{a(h.next(e))}catch(e){t(e)}}function r(e){try{a(h.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,r)}a((h=h.apply(n,s||[])).next())});var n,s,o,h}}))},36441:(e,t,n)=>{n.d(t,{dj:()=>l,fM:()=>c,i_:()=>p,lG:()=>u});var s=n(35762),o=n(17384),i=function(e,t,n,s){return new(n||(n=Promise))(function(o,i){function r(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,a)}c((s=s.apply(e,t||[])).next())})};const r=30,a=25;function c(){return i(this,void 0,void 0,function*(){return s.h.get("/api/at/default/list/",{query:{cursor:0,count:a},baseUrlType:o.Z4.FixedWww})})}function p(e){return i(this,void 0,void 0,function*(){return s.h.get("/api/mention/recent/contact/list/v1/",{query:{mentionType:3,secUid:e},baseUrlType:o.Z4.FixedWww})})}function l(e,t){return i(this,void 0,void 0,function*(){return s.h.get("/api/comment/search/sug/user/",{query:{keyword:e,count:r,mention_type:3,uid_filter_list:t},baseUrlType:o.Z4.FixedWww})})}function u(e){return i(this,void 0,void 0,function*(){return s.h.post("/api/comment/publish/",{query:e,baseUrlType:o.Z4.CommentTest,headers:{[o.nk]:s.h.csrfToken}})})}},44643:(e,t,n)=>{n.d(t,{Gb:()=>p,lY:()=>l});var s=n(46833),o=n(1183),i=n(64388),r=n(25094),a=n(80230);const c=(0,o.p)("exploreActiveCategoryTypeAtom@tiktok/webapp-atoms",s.Yl.ExploreCategoryType_UNDEFINED),{useServiceState:p,useServiceDispatchers:l}=((0,o.p)("exploreBrowserListAtom@tiktok/webapp-atoms",e=>{const t=e(a.Uy)[e(c)];return t?e(t):r.hA},()=>{}),(0,i.i)(c,(e,t)=>({prepareBrowserMode(e){t(c,e)}})))},80230:(e,t,n)=>{n.d(t,{Uy:()=>_,V2:()=>O});var s=n(14974),o=n.n(s),i=n(89768),r=n(1183),a=n(64388),c=n(78695),p=n(87215),l=n(96406),u=n(62972),d=n(25094),m=n(18433),v=n(7615),y=n(43650),g=n(21351),f=n(32119),h=n(96785);const _=(0,r.p)("exploreCategorizedAtomsAtom@tiktok/webapp-atoms",{}),b=(0,r.p)("exploreCategorizedListAtom@tiktok/webapp-atoms",e=>o()(e(_),t=>t?e(t):d.hA),()=>{});function w(e){l.f.sendEvent("row_load_more",{page_name:u.L.Explore,enter_method:"scroll",is_success:e?1:0,is_follow:"0"})}const{useAtomService:O,useServiceDispatchers:C,useServiceState:x}=(0,a.i)(b,(e,t)=>({getExploreList(n){return s=this,o=void 0,l=function*(){const{categoryType:s}=n,{language:o,abTestVersion:a}=(0,i.x)();let l=e(_)[s];l||(l=(0,c._)((0,r.p)(`catAtom_${s}@tiktok/webapp-atoms`,d.hA),{rehydrationKey:`desktop.explorePage.exploreList.${s}`}),t(_,e=>Object.assign(Object.assign({},e),{[s]:l})));try{t(l,e=>Object.assign(Object.assign({},e),{loading:!0}));const n=yield(0,g.e)({language:(0,v.uk)(o),aid:d.xE,count:f.H,categoryType:s,clientABVersions:null==a?void 0:a.versionName,isNonPersonalized:(0,h.XN)()});n.itemList=function(e,t){if(!t)return t;const n=e(_),s=[];for(const t of Object.values(n))t&&s.push(...e(t).list);const o=new Set(s);return t.filter(e=>!o.has(e.id))}(e,n.itemList),w(n.statusCode===p.s.Ok),(0,m.Tj)(e,t,l,y.Lz.Explore,n)}catch(e){w(!1),(0,m.e_)(t,l)}},new((a=void 0)||(a=Promise))(function(e,t){function n(e){try{r(l.next(e))}catch(e){t(e)}}function i(e){try{r(l.throw(e))}catch(e){t(e)}}function r(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a(function(e){e(s)})).then(n,i)}r((l=l.apply(s,o||[])).next())});var s,o,a,l},resetExploreList(n){const s=e(_)[n.categoryType];s&&t(s,d.hA)}}))},87314:(e,t,n)=>{n.d(t,{EL:()=>d,Pk:()=>v,QY:()=>f,YL:()=>y,aF:()=>m,ci:()=>c,jN:()=>u,l1:()=>a,uA:()=>p,xW:()=>g,yw:()=>l});var s=n(69857),o=n(90976),i=n(2232),r=n(70589);const a=()=>{var e;const{abTestVersion:t}=(0,s.L$)((0,o.W)(()=>["abTestVersion"],[]));return{hasRedesign:"v1"===(null!==(e=(0,i.qt)(t,"fyp_redesign"))&&void 0!==e?e:"v0")}},c=()=>{const{hasRedesign:e}=a(),{isInProductHoldout:t}=(0,r.Vv)();return!(!e||t)},p=()=>{var e;const{abTestVersion:t}=(0,s.L$)((0,o.W)(()=>["abTestVersion"],[])),n=null!==(e=(0,i.qt)(t,"immersive_player"))&&void 0!==e?e:"v0";return{enableImmersivePlayer:"v0"!==n,isCommentsDefaultOpen:"v1"===n||"v3"===n,hasForcedDarkMode:"v3"===n||"v4"===n}},l=()=>{var e;const{abTestVersion:t}=(0,s.L$)((0,o.W)(()=>["abTestVersion"],[])),n=null!==(e=(0,i.qt)(t,"preload_with_left"))&&void 0!==e?e:"0";return{preloadThreshold:Number(n)}},u=()=>{var e,t;const{abTestVersion:n}=(0,s.L$)((0,o.W)(()=>["abTestVersion"],[])),a=null!==(e=(0,i.qt)(n,"fyp_comments_panel"))&&void 0!==e?e:"v0",c="v1"===(null!==(t=(0,i.qt)(n,"fyp_redesign"))&&void 0!==t?t:"v0"),{isInProductHoldout:p}=(0,r.Vv)(),l=!p||c;return{hasNewCommentsDesign:l,hasSidebar:l,isDefaultOpen:"v2"===a,isSessionStateControlled:"v3"===a}},d=()=>{const{abTestVersion:e}=(0,s.L$)((0,o.W)(()=>["abTestVersion"],[]));return"v1"===(0,i.qt)(e,"image_fetch_priority")},m=()=>{var e;const{abTestVersion:t}=(0,s.L$)((0,o.W)(()=>["abTestVersion"],[]));return"v0"!==(null!==(e=(0,i.qt)(t,"media_card_redesign"))&&void 0!==e?e:"v0")},v=()=>{var e;const{abTestVersion:t}=(0,s.L$)((0,o.W)(()=>["abTestVersion"],[]));return{isInAppStyleShareExperiment:"v0"!==(null!==(e=(0,i.qt)(t,"app_style_share"))&&void 0!==e?e:"v0")}},y=()=>{var e;const{abTestVersion:t}=(0,s.L$)((0,o.W)(()=>["abTestVersion"],[]));return{isInFypResumeProgressExperiment:"v0"!==(null!==(e=(0,i.qt)(t,"fyp_resume_progress"))&&void 0!==e?e:"v0")}},g=()=>{var e;return{isInWebappPerfPageSwitchExperiment:"v0"!==(null!==(e=(0,i.d)("webapp_perf_page_switch"))&&void 0!==e?e:"v0")}},f=()=>{var e;const{abTestVersion:t}=(0,s.L$)((0,o.W)(()=>["abTestVersion"],[]));return{shouldUpdateCommentsUrl:"v0"===(null!==(e=(0,i.qt)(t,"comments_panel_url"))&&void 0!==e?e:"v0")}}},97118:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(24643),o=n(40099),i=n(76926);const r={id:"Flag-18fcd14e",use:"Flag-18fcd14e-usage",viewBox:"0 0 48 48",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" id="Flag-18fcd14e"><path d="M9 9.31v17.75c5.27-1.73 11.45-2.05 16.16 1.31 4.03 2.88 9.52 2.01 13.84.32V10.94c-5.27 1.73-11.45 2.05-16.16-1.31-4-2.86-9.53-2.01-13.84-.32M43 8v22a2 2 0 0 1-1.1 1.79c-5.83 2.9-13.5 3.82-19.06-.16C18.8 28.75 13.32 29.6 9 31.3V44a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V8c0-.75.44-1.45 1.1-1.79 5.75-2.87 13.62-3.73 19.06.16 4.37 3.13 10.43 2.04 14.95-.16C41.4 5.56 43 6.54 43 8" /></symbol>'};function a(e){const t=(0,o.useContext)(i.X);return(0,o.useLayoutEffect)(()=>(t.add(r),()=>{t.remove("Flag-18fcd14e")}),[]),(0,s.jsx)("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor"},e,{children:(0,s.jsx)("use",{xlinkHref:"#Flag-18fcd14e"},void 0)}),void 0)}}}]);